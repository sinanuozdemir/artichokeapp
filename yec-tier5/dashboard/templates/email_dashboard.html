<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">

<head>
<link rel="shortcut icon" href="{% static "img/favicon.ico" %}" type="image/x-icon">
	<link rel="icon" href="{% static "img/favicon.ico" %}" type="image/x-icon">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="Dashboard">
	<meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

	<title>Legion Analytics-People Analytics</title>

	<!-- Bootstrap core CSS -->
	<link type="text/css" rel="stylesheet" href="{% static "css/bootstrap2.css" %}" />
	<!--external css-->
	<link href="{% static "font-awesome/css/font-awesome.css" %}" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="{% static "lineicons/style.css" %}">
	<link href="{% static "css/style_influencers.css" %}" rel="stylesheet">
	<link href="{% static "css/style.v2.0.css" %}" rel="stylesheet">
	<link media="(min-width:620px) and (max-width:950px)" href="{% static "css/style-responsive.css" %}" rel="stylesheet">
	<!--This is the graph's style-->
	<style>
		   circle {
        fill: #bce5ba;
		}
		.chart rect {
        fill: #bce5ba;
		}

		text {
			font: 12px "Montserrat UltraLight";
		}

		.max text {
			fill: #3b3b3b;
		}

		.non_max text{
			fill: #f8f8f8;
		}
		.bmax {
			opacity : 1;
		}

		.bnon_max {
			opacity : 0;
		}

		.bnon_max:hover {
			opacity : 1;
		}
		.non_max:hover text {
			fill: #3b3b3b;
		}
		
		 path, line {
			fill: none;
		}

		.path {
			fill: none;
			stroke: #3b3b3b;
			stroke-width: 3px;
		}

		/*green line*/
		.line_green {
			fill: none;
			stroke: #84c682;
			stroke-width: 1.5px;
		}

		/*red line*/
		.line_red {
			fill: none;
			stroke: #dc8582;
			stroke-width: 1.5px;
		}

		/*regular line*/
		.line_black {
			fill: none;
			stroke: #c5c5c5;
			stroke-width: 1.5px;
		}

		/*non_main class property*/
		.non_main {
			opacity: .2;
			display: none;
		}

		/*non_main class hovered*/
		.non_main:hover {
			opacity: 1;        
		}

		/*main class hovered*/
		.main {
			opacity: 1;
		}

		/*css for logo*/
		.floating_graph_logo {
			margin: 50px 40px 50px 40px;
		}   
	</style>
	<!--end of graph stylesheet-->
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62659538-1', 'auto');
  ga('send', 'pageview');

</script>
	
</head>

<body>
	<section id="container">
		<header class="header black-bg">

			<!--logo start-->
			<a href="/legion/dashboard" class="logo"><b>Legion</b> Analytics</a>
			<a href="/legion/dashboard" class="dashTab tabSelected"><span>Inbound</span></a>
			<a href="/legion/lead_stream" class="leadTab"><span>Outbound</span></a>
			<a href="/legion/my_account" class="settings-tab"><i class="fa fa-cog"></i></a>

			<!--logo end-->
		</header>
		
		
		<!--KPI header-->
		
		
		<div class="kpiHeader">
			<div class="mainCompany">
				<div class="arrow leftArrow"><i class="fa fa-chevron-left"></i></div>
				<div class="slideShowContainer">
					<div class="deleteCircle hidden">x</div>
					<div class="slideReel">
						<img class="companyLogo currentComp" id="slide1" src="{{request.user.twitter_picture}}"/>
						{% if request.session.30.competitors.0 %}<img class="companyLogo" id="slide2" comp="{{request.session.30.competitors.0.competitor_id}}" src="{{request.session.30.competitors.0.company_logo}}"/>{% endif %}
						{% if request.session.30.competitors.1 %}<img class="companyLogo" id="slide3" comp="{{request.session.30.competitors.1.competitor_id}}" src="{{request.session.30.competitors.1.company_logo}}"/>{% endif %}
						{% if request.session.30.competitors.2 %}<img class="companyLogo" id="slide4" comp="{{request.session.30.competitors.2.competitor_id}}" src="{{request.session.30.competitors.2.company_logo}}"/>{% endif %}
					</div>
				</div>
				<div class="arrow rightArrow"><i class="fa fa-chevron-right"></i></div>
				{% if request.user.twitter_handle and not request.session.30.competitors.2 > 0 %}
				<div class="addCompetitor" data-target=".bs-example-modal-lg" data-toggle="modal">Add Competitor</div>
				{% endif %}
			</div>
			<div class="kpiNumbers">
				<table class="kpiTable">
					<tr>
						<td class="clickKPI" id="stat1kpi"></td>
						<td class="clickKPI" id="stat2kpi"></td>
						<td class="clickKPI" id="stat3kpi"></td>
						<td class="clickKPI" id="stat4kpi"></td>
						<td class="clickKPI" id="stat5kpi"></td>
					</tr>
				</table>
			</div>
			<div class="kpiWords">

				<table class="kpiTable">
					<tr>
						{% for setting in settings.inbound_settings.toolbar %}
						<td class="changeKPI" id="stat{{forloop.counter}}">{{setting}}</td>
						{% endfor %}
					</tr>
				</table>
			</div>
		</div>
		
		
		<div class="kpiSelector">
			<div>--------Change KPI--------</div>
			<div valuePrime="{{request.session.30.me.positive_count}}" valueComp1="{{request.session.30.competitors.0.positive_count}}" valueComp2="{{request.session.30.competitors.1.positive_count}}" valueComp3="{{request.session.30.competitors.2.positive_count}}" class="kpioption" id="selected">Positive Comments</div>
			<div valuePrime="{{request.session.30.me.negative_count}}" valueComp1="{{request.session.30.competitors.0.negative_count}}" valueComp2="{{request.session.30.competitors.1.negative_count}}" valueComp3="{{request.session.30.competitors.2.negative_count}}" class="kpioption">Negative Comments</div>
			<div valuePrime="{{request.session.30.me.pop_change}}" valueComp1="{{request.session.30.competitors.0.pop_change}}" valueComp2="{{request.session.30.competitors.1.pop_change}}" valueComp3="{{request.session.30.competitors.2.pop_change}}" class="kpioption">P.o.P Change</div>
			<div valuePrime="{{request.session.30.me.sentiment}}%" valueComp1="{{request.session.30.competitors.0.sentiment}}%" valueComp2="{{request.session.30.competitors.1.sentiment}}%" valueComp3="{{request.session.30.competitors.2.sentiment}}%" class="kpioption">Today's Sentiment</div>
			<div valuePrime="{{request.session.30.me.most_recent_followers}}" valueComp1="{{request.session.30.competitors.0.most_recent_followers}}" valueComp2="{{request.session.30.competitors.1.most_recent_followers}}" valueComp3="{{request.session.30.competitors.2.most_recent_followers}}" class="kpioption">Total People</div>
			<div valuePrime="{{request.session.30.me.change_followers}}" valueComp1="{{request.session.30.competitors.0.change_followers}}" valueComp2="{{request.session.30.competitors.1.change_followers}}" valueComp3="{{request.session.30.competitors.2.change_followers}}" class="kpioption">New Twitter Followers</div>
			<div valuePrime="{{request.session.30.me.most_recent_followers}}" valueComp1="{{request.session.30.competitors.0.most_recent_followers}}" valueComp2="{{request.session.30.competitors.1.most_recent_followers}}" valueComp3="{{request.session.30.competitors.2.most_recent_followers}}" class="kpioption">New Email Subscribers</div>
			<!-- <div valuePrime="15" valueComp1="15" valueComp2="15" valueComp3="15" class="kpioption">Period (15 Days)</div> -->
			<div valuePrime="30" valueComp1="30" valueComp2="30" valueComp3="30" class="kpioption">Period (30 Days)</div>
			<!-- <div valuePrime="45" valueComp1="45" valueComp2="45" valueComp3="45" class="kpioption">Period (45 Days)</div> -->
		</div>
		
		<!--Adding Competitor Modal Form-->
		
		
		<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-md">
				<div class="targetMarketNotification targetNameError"><i class="fa fa-exclamation"></i> Please add the name of your competitor.</div>
				<div class="targetMarketNotification targetWebError"><i class="fa fa-exclamation"></i> Please add a website for your competitor.</div>
				<div class="targetMarketNotification targetTwitterError"><i class="fa fa-exclamation"></i> Please add the competitor's twitter handle to track.</div>
				<div class="targetMarketNotification targetSuccess"><i class="fa fa-bell"></i> Success! Adding Now.</div>
				<form method="post" id="newCompetitor"> {% csrf_token %}
					<div class="modal-content">
						<div class="modal-header" id="leadModalHeader">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title leadModalTitle competitor_header" id="gridSystemModalLabel">Competitor Information</h4>
						</div>
						<div class="leadTargetMarketForm">
							<div class="insideTMForm">
								<label class="compLabel">Company Name *</label>
								<input name="company_name" class="tmjt" id="tmjt" type="text" placeholder="Tier5" required/>
								<label class="compLabel">Company Website *</label>
								<input name="company_website" class="tml" type="url" placeholder="http://tier5.co" required/>
								<label class="compLabel">Company Twitter *</label>
								<input name="company_twitter" class="tml" type="text" placeholder="@tier5co" required/>
								<label class="compLabel">Company Facebook</label>
								<input name="company_facebook" class="tml" type="url" placeholder="https://www.facebook.com/tier5international"/>
								<label class="compLabel">Company Linkedin</label>
								<input name="company_linkedin" class="tml" type="url" placeholder="https://www.linkedin.com/company/tier5"/>
								<label class="compLabel">Keywords</label>
								<input name="company_keywords" class="tml" type="text" placeholder="tier5, legionanalytics"/>
								<div class="targetMarketFooter">
										<button type="submit" class="btn-tmadd">Add Competitor</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<!--Graph dropdown field/Side Barish-->

		<div class="graphSelection">
			<div id="activeSelection">Sentiment</div>
			<i class="fa fa-chevron-down" id="dropDownSelection"></i>
		</div>
		<div class="graphDropDown">
				<div class="option" id="selected">Sentiment</div>
				<div class="option">Demographics</div>
				<div class="option">Consumers</div>
		</div>
		
		<div class="recentConsumers">
			<div class="consumer consumer-total">
				Recent Audience
			</div>
			{% for person in request.session.30.most_recent_people %}
			<div class="consumer" id={{person.id}}>
				<div class="cName">{{person.name|truncatechars:17}}</div>
				<div class="cType">subscribed to you</div>
				<div class="hidden" id="cind_photo{{person.id}}" value="https://s3-us-west-2.amazonaws.com/tier5/{{person.saved_photo}}"></div>
				<div class="hidden" id="cind_location{{person.id}}" value="{{person.location}}"></div>
				<div class="hidden" id="cind_website{{person.id}}" value="{{person.personal_home_page}}"></div>
				<div class="hidden" id="cind_email{{person.id}}" value="{{person.emailaddress__address}}"></div>
				<div class="hidden" id="cind_klout{{person.id}}" value="{{person.klout_score}}"></div>
				<div class="hidden" id="cind_sentiment{{person.id}}" value="{{person.sentiment}}"></div>
				<div class="hidden" id="cind_age{{person.id}}" value="{{person.age}}"></div>
				<div class="hidden" id="cind_fb{{person.id}}" value="{{person.personal_facebook}}"></div>
				<div class="hidden" id="cind_tw{{person.id}}" value="{{person.personal_twitter}}"></div>
				<div class="hidden" id="cind_ln{{person.id}}" value="{{person.personal_linkedin}}"></div>
				<div class="hidden" id="cind_name{{person.id}}" value="{{person.name|truncatechars:17}}"></div>
				{% for tweet in person.tweets %}
				<div class="hidden" id="c{{person.id}}ind_tweet{{forloop.counter}}" value="{{person.tweets.forloop.counter0.text}}"></div>
				<div class="hidden" id="c{{person.id}}ind_tweet_score{{forloop.counter}}" value="{{person.tweets.forloop.counter0.textblob_sentiment}}">
					<div class="hidden" id="c{{person.id}}ind_tweet_time{{forloop.counter}}" value="{{person.tweets.forloop.counter0.datestr}}"></div>
				<div class="hidden" id="c{{person.id}}ind_tweet_id{{forloop.counter}}" value="{{person.tweets.forloop.counter0.status_id}}"></div>
			</div>
				{% endfor %}
			</div>
			{% endfor %}
		</div>
		
		<div id="consumerFilters">
			
			<form method="post" id="filterForm">{% csrf_token%}
			
				<div class="filterTitle" style="font-family:'Roboto Slab Regular', sans-serif;">Filter</div>

				<div class="filter" name="allFilterDiv" id="allFilter"><div class="companyCheckbox" id="allCheck"><i class="fa fa-check checked hidden"></i></div> &nbsp;View All</div>
				<input class="hidden" type="checkbox" id="allFilterCheckbox" name="all" />

				<div class="filter" name="followFilterDiv" id="followFilter"><div class="companyCheckbox" id="followCheck"><i class="fa fa-check checked"></i> </div> &nbsp;Twitter Followers</div>
				<input class="hidden" type="checkbox" id="followFilterCheckbox" name="followers" checked/>

				<div class="filter" name="subscriberFilterDiv" id="subscriberFilter"><div class="companyCheckbox" id="subscriberCheck"><i class="fa fa-check checked hidden"></i></div>  &nbsp;Email Subscribers</div>
				<input class="hidden" type="checkbox" id="subscriberFilterCheckbox" name="subscriber"  />

				<div class="filterTitle" style="font-family:'Roboto Slab Regular', sans-serif; left:0px;">Advanced</div>

				<div class="filter" name="positiveFilterDiv" id="positiveFilter"><div class="companyCheckbox" id="positiveCheck"><i class="fa fa-check checked hidden"></i></div> &nbsp;Positive Audience</div>
				<input class="hidden" type="checkbox" id="positiveFilterCheckbox" name="positive"  />

				<div class="filter"  name="negativeFilterDiv" id="negativeFilter"><div class="companyCheckbox" id="negativeCheck"><i class="fa fa-check checked hidden"></i></div> &nbsp;Negative Audience</div>
				<input class="hidden" type="checkbox" id="negativeFilterCheckbox" name="negative"  />

				<div class="filter" name="topTenFilterDiv" id="topTenFilter"><div class="companyCheckbox" id="topTenCheck"><i class="fa fa-check checked hidden"></i></div> &nbsp;Top Ten Influencers</div>
				<input class="hidden" type="checkbox" id="topTenFilterCheckbox" name="top_ten"  />
				
				
				<button type="submit" class="tier5-btn-sm" id="consumerFilterBtn" style="margin-left: 20px;">Search</button>
			</form>
			
		</div>
	
		
		
		<!--D3 Top Graph Container-->
		<div id="sentimentPage">
			<div class="d3GraphContainer">
                <!-- this needs to be done when a new event is created -->
                <!-- <div class="eventBox" id="eventBox_A" style="position:absolute; top: 218.5px;left:800px; width: 17px; padding:2px;font-size:9px; height:15px; color: #3b3b3b; background-color: #959595; font-family:'Montserrat Bold'; text-align:center;">A</div>
                <div class="eventLine" id="eventLine_A" style="position:absolute; top: 60px;left:800px; width: 0px; border: 1px dashed #c5c5c5; height:156px;"></div>
                <div class="eventPercent" id="eventPercent_A" style="position:absolute;padding:1px; font-size:10px; top: 204px; left:800px;height:15px; background-color: #bce5ba; color: #000000; text-align:center;"></div> -->
                <div class="checkboxContainer">
                    <div class="compName" id="comp2"></div>
                    <div class="compName" id="comp3"></div>
                    <div class="compName" id="comp4"></div>
                </div>
			</div>
			<!-- Bottom Graph Container-->
			<div class="bottomGraphContainer">
				<div class="tier5-btn addEventBtn" data-target=".bs-modal-lg" data-toggle="modal">Add Event</div>
				<div class="deleteMarketEvent hidden">x</div>
				<div class="deleteMarketEventSuccess hidden">&#10004;</div>
				<table class="kpiTable eventTable table table-bordered">
					<thead class="eventHeader">
						<th class="dataHead">Event #</th>
						<th class="dataHead">Name</th>
						<th class="dataHead">Type</th>
						<th class="dataHead">Date</th>
						<th class="dataHead">New Followers</th>
						<th class="dataHead">Effect on Sentiment</th>
					</thead>
					{% if request.session.30.me.market_events%}
					{% for event in request.session.30.me.market_events %}
					{% if event.percent_change_in_sentiment > 0 %}
					<tr class="sentimentSignal green" id="{{event.id}}">
						
						<td class="sentimentEvent">{{forloop.counter}}</td>
						<td class="sentimentEvent">{{event.name}}</td>
						<td class="sentimentEvent">{{event.type_of_event}}</td>
						<td class="sentimentEvent">{{event.date_started}}</td>
						<td class="sentimentEvent">{{event.change_in_followers}}</td>
						<td class="sentimentEvent">{{event.percent_change_in_sentiment}}%</td>
					</tr>
					{% elif event.percent_change_in_sentiment < 0 %}
					<tr class="sentimentSignal red" id="{{event.id}}">
						
						<td class="sentimentEvent">{{forloop.counter}}</td>
						<td class="sentimentEvent">{{event.name}}</td>
						<td class="sentimentEvent">{{event.type_of_event}}</td>
						<td class="sentimentEvent">{{event.date_started}}</td>
						<td class="sentimentEvent">{{event.change_in_followers}}</td>
						<td class="sentimentEvent">{{event.percent_change_in_sentiment}}%</td>
					</tr>
					{% else %}
					<tr class="sentimentSignal" id="{{event.id}}">
						
						<td class="sentimentEvent">{{forloop.counter}}</td>
						<td class="sentimentEvent">{{event.name}}</td>
						<td class="sentimentEvent">{{event.type_of_event}}</td>
						<td class="sentimentEvent">{{event.date_started}}</td>
						<td class="sentimentEvent">{{event.change_in_followers}}</td>
						<td class="sentimentEvent">{{event.percent_change_in_sentiment}}%</td>
					</tr>
					{% endif %}
					{% endfor %}
					{% else %}
					<tr class="sentimentSignal">
						<td class="sentimentEvent">1</td>
						<td class="sentimentEvent">Started using Tier5</td>
						<td class="sentimentEvent">Technology Adoption</td>
						<td class="sentimentEvent">Today</td>
						<td class="sentimentEvent">0</td>
						<td class="sentimentEvent">32%</td>
					</tr>
					{%endif%}
				</table>
			</div>
		</div>
		
		
		<!--Event Modal-->
		<div class="modal fade bs-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-md">
				<div class="targetMarketNotification eventError targetNameError"><i class="fa fa-exclamation"></i> Please name your event.</div>
				<div class="targetMarketNotification eventError targetTypeError"><i class="fa fa-exclamation"></i> Please add a type for your event.</div>
				<div class="targetMarketNotification eventError targetSuccess"><i class="fa fa-bell"></i> Success! Adding Now.</div>
				<form method="post" id="newEvent"> {% csrf_token %}
					<div class="modal-content">
						<div class="modal-header" id="leadModalHeader">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title leadModalTitle competitor_header" id="gridSystemModalLabel">Event Information</h4>
						</div>
						<div class="leadTargetMarketForm">
							<div class="insideTMForm">
								<label class="compLabel">Event Name *</label>
								<input name="event_name" class="tmjt" id="tmjt" type="text" placeholder="Tier5" required/>
								<label class="compLabel">Event Type *</label>
								<input name="event_type" class="tml" type="text" placeholder="Product Launch" required/>
								<label class="compLabel">Start Date *</label>
								<input name="event_date" class="tml" type="text" id="datetimeInput" required/>
								<div class="targetMarketFooter">
										<button type="submit" class="btn-tmadd">Add Event</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<div id="demographicPage">
			<div class="d3GraphContainer">
				<table class="demoGraphs">
					<tr class="demoGraphs">
						<td id="ageGraph"><svg class="chart age-chart"> </svg></td>
						<td id="smGraph"><svg class="chart sm-chart"> </svg></td>
						<td id="industryGraph"></td>
					</tr>
				</table>
			</div>
			<div class="bottomGraphContainer">
			    <div id="cartograph" style="position: relative; width: 400px; height: 230px;">
				</div>
            </div>
			<div id="topAudience">
					<table>
						<tr>
							<td class="audience" id="ntrlC">
								<p>Largest Audience by City
									<div class="neutralUnderline"></div>
								</p>
								<div class="cities">
									<div>1. <span id="city1">{% if request.session.inbound_stats.all_cities.0 %}{{request.session.inbound_stats.all_cities.0.0}}{% else %}-{% endif %}</span>
									</div>
									<div>2. <span id="city2">{% if request.session.inbound_stats.all_cities.1 %}{{request.session.inbound_stats.all_cities.1.0}}{% else %}-{% endif %}</span>
									</div>
									<div>3. <span id="city3">{% if request.session.inbound_stats.all_cities.2 %}{{request.session.inbound_stats.all_cities.2.0}}{% else %}-{% endif %}</span>
									</div>
									<div>4. <span id="city4">{% if request.session.inbound_stats.all_cities.3 %}{{request.session.inbound_stats.all_cities.3.0}}{% else %}-{% endif %}</span>
									</div>
									<div>5. <span id="city5">{% if request.session.inbound_stats.all_cities.4 %}{{request.session.inbound_stats.all_cities.4.0}}{% else %}-{% endif %}</span>
									</div>
									<div>6. <span id="city6">{% if request.session.inbound_stats.all_cities.5 %}{{request.session.inbound_stats.all_cities.5.0}}{% else %}-{% endif %}</span>
									</div>
									<div>7. <span id="city7">{% if request.session.inbound_stats.all_cities.6 %}{{request.session.inbound_stats.all_cities.6.0}}{% else %}-{% endif %}</span>
									</div>
									<div>8. <span id="city8">{% if request.session.inbound_stats.all_cities.7 %}{{request.session.inbound_stats.all_cities.7.0}}{% else %}-{% endif %}</span>
									</div>
									<div>9. <span id="city9">{% if request.session.inbound_stats.all_cities.8 %}{{request.session.inbound_stats.all_cities.8.0}}{% else %}-{% endif %}</span>
									</div>
									<div>10. <span id="city10">{% if request.session.inbound_stats.all_cities.9 %}{{request.session.inbound_stats.all_cities.9.0}}{% else %}-{% endif %}</span>
									</div>
								</div>
							</td>
							<td class="audience" id="posC">
								<p>Largest Positive Audience by City
									<div class="positiveUnderline"></div>
								</p>
								<div class="cities">
									<div>1. <span id="city1">{% if request.session.inbound_stats.positive_cities.0 %}{{request.session.inbound_stats.positive_cities.0.0}}{% else %}-{% endif %}</span>
									</div>
									<div>2. <span id="city2">{% if request.session.inbound_stats.positive_cities.1 %}{{request.session.inbound_stats.positive_cities.1.0}}{% else %}-{% endif %}</span>
									</div>
									<div>3. <span id="city3">{% if request.session.inbound_stats.positive_cities.2 %}{{request.session.inbound_stats.positive_cities.2.0}}{% else %}-{% endif %}</span>
									</div>
									<div>4. <span id="city4">{% if request.session.inbound_stats.positive_cities.3 %}{{request.session.inbound_stats.positive_cities.3.0}}{% else %}-{% endif %}</span>
									</div>
									<div>5. <span id="city5">{% if request.session.inbound_stats.positive_cities.4 %}{{request.session.inbound_stats.positive_cities.4.0}}{% else %}-{% endif %}</span>
									</div>
									<div>6. <span id="city6">{% if request.session.inbound_stats.positive_cities.5 %}{{request.session.inbound_stats.positive_cities.5.0}}{% else %}-{% endif %}</span>
									</div>
									<div>7. <span id="city7">{% if request.session.inbound_stats.positive_cities.6 %}{{request.session.inbound_stats.positive_cities.6.0}}{% else %}-{% endif %}</span>
									</div>
									<div>8. <span id="city8">{% if request.session.inbound_stats.positive_cities.7 %}{{request.session.inbound_stats.positive_cities.7.0}}{% else %}-{% endif %}</span>
									</div>
									<div>9. <span id="city9">{% if request.session.inbound_stats.positive_cities.8 %}{{request.session.inbound_stats.positive_cities.8.0}}{% else %}-{% endif %}</span>
									</div>
									<div>10. <span id="city10">{% if request.session.inbound_stats.positive_cities.9 %}{{request.session.inbound_stats.positive_cities.9.0}}{% else %}-{% endif %}</span>
									</div>
								</div>
							</td>
							<td class="audience" id="negC">
								<p>Largest Negative Audience by City
									<div class="negativeUnderline"></div>
								</p>
								<div class="cities">
									<div>1. <span id="city1">{% if request.session.inbound_stats.negative_cities.0 %}{{request.session.inbound_stats.negative_cities.0.0}}{% else %}-{% endif %}</span>
									</div>
									<div>2. <span id="city2">{% if request.session.inbound_stats.negative_cities.1 %}{{request.session.inbound_stats.negative_cities.1.0}}{% else %}-{% endif %}</span>
									</div>
									<div>3. <span id="city3">{% if request.session.inbound_stats.negative_cities.2 %}{{request.session.inbound_stats.negative_cities.2.0}}{% else %}-{% endif %}</span>
									</div>
									<div>4. <span id="city4">{% if request.session.inbound_stats.negative_cities.3 %}{{request.session.inbound_stats.negative_cities.3.0}}{% else %}-{% endif %}</span>
									</div>
									<div>5. <span id="city5">{% if request.session.inbound_stats.negative_cities.4 %}{{request.session.inbound_stats.negative_cities.4.0}}{% else %}-{% endif %}</span>
									</div>
									<div>6. <span id="city6">{% if request.session.inbound_stats.negative_cities.5 %}{{request.session.inbound_stats.negative_cities.5.0}}{% else %}-{% endif %}</span>
									</div>
									<div>7. <span id="city7">{% if request.session.inbound_stats.negative_cities.6 %}{{request.session.inbound_stats.negative_cities.6.0}}{% else %}-{% endif %}</span>
									</div>
									<div>8. <span id="city8">{% if request.session.inbound_stats.negative_cities.7 %}{{request.session.inbound_stats.negative_cities.7.0}}{% else %}-{% endif %}</span>
									</div>
									<div>9. <span id="city9">{% if request.session.inbound_stats.negative_cities.8 %}{{request.session.inbound_stats.negative_cities.8.0}}{% else %}-{% endif %}</span>
									</div>
									<div>10. <span id="city10">{% if request.session.inbound_stats.negative_cities.9 %}{{request.session.inbound_stats.negative_cities.9.0}}{% else %}-{% endif %}</span>
									</div>
								</div>
							</td>
						</tr>
					</table>
					
				</div>
			</div>
		

		<div id="consumerPage">
			<div class="d3GraphContainer consumerGraphContainer">				
				<div class="graphDropDown">
						<div class="option" id="selected">Sentiment</div>
						<div class="option">Demographics</div>
						<div class="option">Consumers</div>
				</div>
				<div class="leftSideConsumer">
					<div class="leadStream" id="leadStream">
						{% for person in request.session.30.most_recent_people %}
						<div class="newOutboundLead" id="{{person.id}}">
							<img class="leadPhoto" src="https://s3-us-west-2.amazonaws.com/tier5/{{person.saved_photo}}"/>
							<div class="hidden" id="ind_photo{{person.id}}" value="https://s3-us-west-2.amazonaws.com/tier5/{{person.saved_photo}}"></div>
							<div class="hidden" id="ind_location{{person.id}}" value="{{person.location}}"></div>
							<div class="hidden" id="ind_website{{person.id}}" value="{{person.personal_home_page}}"></div>
							<div class="hidden" id="ind_email{{person.id}}" value="{{person.emailaddress__address}}"></div>
							<div class="hidden" id="ind_klout{{person.id}}" value="{{person.klout_score}}"></div>
							<div class="hidden" id="ind_sentiment{{person.id}}" value="{{person.sentiment}}"></div>
							<div class="hidden" id="ind_age{{person.id}}" value="{{person.age}}"></div>
							<div class="hidden" id="ind_fb{{person.id}}" value="{{person.personal_facebook}}"></div>
							<div class="hidden" id="ind_tw{{person.id}}" value="{{person.personal_twitter}}"></div>
							<div class="hidden" id="ind_ln{{person.id}}" value="{{person.personal_linkedin}}"></div>
							<div class="hidden" id="ind_name{{person.id}}" value="{{person.name|truncatechars:17}}"></div>
							
							<div class="hidden" id="{{person.id}}ind_tweet1" value="{{person.tweets.0.text}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_score1" value="{{person.tweets.0.textblob_sentiment}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time1" value="{{person.tweets.0.datestr}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time1" value="{{person.tweets.0.status_id}}"></div>

							<div class="hidden" id="{{person.id}}ind_tweet2" value="{{person.tweets.1.text}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_score2" value="{{person.tweets.1.textblob_sentiment}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time2" value="{{person.tweets.1.datestr}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time1" value="{{person.tweets.1.status_id}}"></div>

							<div class="hidden" id="{{person.id}}ind_tweet3" value="{{person.tweets.2.text}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_score3" value="{{person.tweets.2.textblob_sentiment}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time3" value="{{person.tweets.2.datestr}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time1" value="{{person.tweets.2.status_id}}"></div>

							<div class="hidden" id="{{person.id}}ind_tweet4" value="{{person.tweets.3.text}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_score4" value="{{person.tweets.3.textblob_sentiment}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time4" value="{{person.tweets.3.datestr}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time1" value="{{person.tweets.3.status_id}}"></div>

							<div class="hidden" id="{{person.id}}ind_tweet5" value="{{person.tweets.4.text}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_score5" value="{{person.tweets.4.textblob_sentiment}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time5" value="{{person.tweets.4.datestr}}"></div>
							<div class="hidden" id="{{person.id}}ind_tweet_time1" value="{{person.tweets.4.status_id}}"></div>


							
							<div class="leadName">{{person.name|truncatechars:20}}<span> followed @{{request.user.twitter_handle}}</span></div>
							<div class="largeTweet"></div>
						</div>
						{% endfor %}
						
					</div>
				</div>
				<div class="rightSideConsumer">
					<div class="rightSideLead">
						<img class="bigLeadPhoto" src="https://s3-us-west-2.amazonaws.com/tier5/img/redlogotier5.svg"/>
						<div class="bigLeadName">Oliver The Octopus</div>
						<div class="bigJobTitle">
							<span class="personSocialMedia" id="personSocialMedia"><a href="http://www.facebook.com/jamasen.rodriguez" target="_blank"><i class="fa fa-facebook bigSmIcon"></i></a><a href="http://www.twitter.com/jamasenr" target="_blank"><i class="fa fa-twitter bigSmIcon"></i></a><a href="http://www.linkedin.com/pub/jamasen-rodriguez/38/901/54b" target="_blank"><i class="fa fa-linkedin bigSmIcon"></i></a></span>	
						</div>			
						<div class="bigAge">Age: 2</div>
						<div class="bigLocation">Location: San Francisco</div>
						<div class="bigWebsite">Website: <a href="http://tier5.co" target="_blank">http://tier5.co</a></div>
						<div class="bigEmail">Email: oliver@legionanalytics.com</div>
						<div class="bigKlout">Kout Score: 12</div>
					</div>
					
					<div class="consumerSentiment" id="total_sentiment">
						Positive Sentiment
					</div>
					
					<div class="handleId" id="person_tw_handle">
						@jamasenr tweeted:
					</div>



					<div id="tweetContainer">
						<div class="consumerSentiment consumerTweet positive">
						@tier5co's octopus is the cutest thing I've seen in a long time! You go Tier5!
							<div class="sentimentScore" id="tweet1">Sentiment score of 72 (Reply Now!)<i class="glyphicon glyphicon-share-alt replyTweet"></i></div>
						</div>
						<div class="consumerSentiment replyConsumerTweet hidden" id="hiddentweet1">
							<form method="post" name="tweetForm1">{% csrf_token %}
								<textarea thisname="jamasenr" placeholder="Reply to this tweet to turn Jamasen into a brand advocate!" class="negativeReplyBox" form="tweetForm" name="tweetTextArea" id="jamasenrtweet1" maxlength="140"></textarea>
								<button type="submit" class="whiteBtn tier5-btn sendTweetBtn" id="jamasenrtweet1sendTweet">Send Tweet</button>
							</form>
						</div>
					</div>


				</div>
			</div>
		</div>
		<div class="errorMsg hidden"><i class="fa fa-warning"></i> We're having trouble connecting to Legion Analytics.</div>
		<div class="successMsg hidden"><i class="fa fa-bell-o"></i> We're back!</div>
	</section>




	<script src="{% static "js/jquery.js" %}"></script>
	<script src="{% static "js/jquery-1.8.3.min.js" %}"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	
	<script src="{% static "js/bootstrap.min.js" %}"></script>
	
	<script src="{% static "js/jquery.nicescroll.js" %}" type="text/javascript"></script>
	<script src="{% static "js/common-scripts.js" %}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script> 
	<script src="{% static "js/map.js" %}"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
 	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
 	<link rel="stylesheet" href="/resources/demos/style.css">


	<!--dashboard unique js-->

	<script>
		$(document).ready(function(){
			$("#tweetContainer").delegate(".sentimentScore","click",function(){
				var ctid = $(this).attr("id");
				if($("#hidden"+ctid).hasClass("hidden")){
					$("#hidden"+ctid).slideDown("fast").toggleClass( "hidden" );
				}else{
					$("#hidden"+ctid).slideUp("fast");
					window.setTimeout(function(){
						$("#hidden"+ctid).toggleClass( "hidden" );
					}, 500);
				}
				
			});
		});
	</script>

	<!--Slider and KPIs for competitors-->
	<script>
		$(document).ready(function(){
			var sid = "slide1";//sid tells me which slide i'm on so I can show the correct data to the user for the graphs.
			var i = 0;
			var left = 0;
			var back = 0;
			var kid ="";
			var kpitext = "";
			var currentCompany = "";
			var kpivalue = "";
			var nospace ="";
			var whatClass ="";
		
			
			
			///////////////////////
			/////Company Slider////
			//////////////////////
			
				for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.total_people}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.most_recent_followers}}");
						}else if($("#stat"+numi).text() == "Period (45 Days)"){
							$("#stat"+numi+"kpi").text("45");
						}else if($("#stat"+numi).text() == "Period (30 Days)"){
							$("#stat"+numi+"kpi").text("30");
						}else if($("#stat"+numi).text() == "Period (15 Days)"){
							$("#stat"+numi+"kpi").text("15");
						}
					
					}
			
			$(".rightArrow").on("click", function(){
				if(i==0){
					{% if request.session.30.competitors.0 %}
					$(".slideReel").animate({
						left: "-90px",
					});
					sid = "slide2";
					$(".companyLogo").removeClass("currentComp");
					$("#"+sid).addClass("currentComp");
					
					//change header stats
					for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.most_recent_followers}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.most_recent_followers}}");
						}
					}
					
					//end change header stats
					
					
					
					i++;
					 {%endif%}
				}else if(i==1){
					{% if request.session.30.competitors.1 %}
					$(".slideReel").animate({
						left: "-190px",
					});
					sid ="slide3";
					$(".companyLogo").removeClass("currentComp");
					$("#"+sid).addClass("currentComp");
						for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.most_recent_followers}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.most_recent_followers}}");
						}
					}
					i++;
					 {%endif%}
				}else if(i==2){
					{% if request.session.30.competitors.2 %}
					$(".slideReel").animate({
						left: "-290px",
					});
					sid="slide4";
					$(".companyLogo").removeClass("currentComp");
					$("#"+sid).addClass("currentComp");
						for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.most_recent_followers}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.2.most_recent_followers}}");
						}
					}
					i++;
					 {%endif%}
				}
			});
			$(".leftArrow").on("click", function(){
				if(i==3){
					{% if request.session.30.competitors.1 %}
					$(".slideReel").animate({
						left: "-190px",
					});
					sid="slide3";
					$(".companyLogo").removeClass("currentComp");
					$("#"+sid).addClass("currentComp");
						for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.most_recent_followers}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.1.most_recent_followers}}");
						}
					}
					i--;
					 {%endif%}
				}else if(i==2){
					{% if request.session.30.competitors.0 %}
					$(".slideReel").animate({
						left: "-90px",
					});
					sid="slide2";
					$(".companyLogo").removeClass("currentComp");
					$("#"+sid).addClass("currentComp");
						for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.most_recent_followers}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.competitors.0.most_recent_followers}}");
						}
					}
					i--;
					 {%endif%}
				}else if(i==1){
					$(".slideReel").animate({
						left: "0px",
					});
					sid="slide1";
					$(".companyLogo").removeClass("currentComp");
					$("#"+sid).addClass("currentComp");
						for(var numi = 1; numi<6; numi++){
						if($("#stat"+numi).text() == "Total People"){
							$("#stat"+numi+"kpi").text("{{request.session.total_people}}");
						}else if($("#stat"+numi).text() == "Positive Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.positive_count}}");
						}else if($("#stat"+numi).text() == "Negative Comments"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.negative_count}}");
						}else if($("#stat"+numi).text() == "P.o.P Change"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.pop_change}}");
						}else if($("#stat"+numi).text() == "Today's Sentiment"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.sentiment}}%");
						}else if($("#stat"+numi).text() == "New Twitter Followers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.change_followers}}");
						}else if($("#stat"+numi).text() == "New Email Subscribers"){
							$("#stat"+numi+"kpi").text("{{request.session.30.me.most_recent_followers}}");
						}
					}
					i--;
				}
			});
			
			
			//on click of the dropdown selection div, the drop down becomes displayed
			$(".graphSelection").on("click",function(){
				$(".graphDropDown").fadeIn(200);
			});
			
			
			
			//when the user clicks an option from the dropdown field, it should change the body graphs
			$(".option").on("click",function(){
				var text = $(this).text();
				$("#activeSelection").text(text);
				$(".graphDropDown").fadeOut(200);
				if(text!="Sentiment"){
					$("#sentimentPage").fadeOut(300);
				}else{
					$("#sentimentPage").fadeIn(200);
					$(".recentConsumers").fadeIn(200);
					
				}
				if(text!="Demographics"){
					$("#demographicPage").fadeOut(300);
				}else{
					$("#demographicPage").fadeIn(200);
					$(".recentConsumers").fadeIn(200);
				
				}
				if(text!="Consumers"){
					$("#consumerPage").fadeOut(300);
					$("#consumerFilters").fadeOut(200);
				}else{
					$("#consumerPage").fadeIn(200);
					$(".recentConsumers").fadeOut(200);
					$("#consumerFilters").fadeIn(200);
				}
				//take away recent consumers when consumers is active
				
			});
			
			
			
			
			//Just a way for the dropdown div to disappear when the user moves their mouse away
			$(".graphDropDown").hover(function(){
				
			},function(){
				$(".graphDropDown").fadeOut(200);
			});
			
			
			
			//when you click on a KPI in the header, the body graphs page change to the corresponding page. ie when you click on today's sentiment, it should send you to the sentiment graphs.
			$(".clickKPI").on("click",function(){
				var eid=$(this).attr("class");
				if(eid=="periodChangeKPI" || eid=="periodKPI"){
					$("#demographicPage").fadeOut(50);
					$("#consumerPage").fadeOut(50);
					$("#consumerFilters").fadeOut(200);
					$("#sentimentPage").fadeIn(50);
					$("#activeSelection").text("Sentiment");
					$(".recentConsumers").fadeIn(200);
					
				}
				if(eid=="peopleKPI" || eid=="negativeKPI" || eid=="positiveKPI"){
					$("#demographicPage").fadeOut(50);
					$("#sentimentPage").fadeOut(50);
					$("#consumerPage").fadeIn(50);
					$("#consumerFilters").fadeIn(200);
					$("#activeSelection").text("Consumers");
					$(".recentConsumers").fadeOut(200);
				}
			});
			

			//user clicks a recent consumer and it changes graph to consumer page
			$(".consumer").on("click",function(){
				$("#demographicPage").fadeOut(50);
				$("#consumerPage").fadeIn(50);
				$("#sentimentPage").fadeOut(50);
				$("#activeSelection").text("Consumers");
				$(".recentConsumers").fadeOut(200);
				$("#consumerFilters").fadeIn(200);
			});
			
			//user clicks kpi name to show change menu
			$(".changeKPI").on("click",function(){
				kid = $(this).attr("id");
				var pushLeft="220px";
				if(kid=="stat2"){
					pushLeft="420px"
				}else if(kid=="stat3"){
					pushLeft="620px"
				}else if(kid=="stat4"){
					pushLeft="820px"
				}else if(kid=="stat5"){
					pushLeft="1020px"
				}
				$(".kpiSelector").css({
					display: "block",
					left: pushLeft,
				});
			});
			
			//click kpi change option and it changes the number shown
			$(".kpioption").on("click",function(){
				kpitext = $(this).text();
				currentCompany = $(".currentComp").attr("id");
				kpivalue = "";
				if(currentCompany == "slide1"){
					kpivalue = $(this).attr('valuePrime');
				}else if(currentCompany == "slide2"){
					kpivalue = $(this).attr('valueComp1');
				}else if(currentCompany == "slide3"){
					kpivalue = $(this).attr('valueComp2');
				}else if(currentCompany == "slide4"){
					kpivalue = $(this).attr('valueComp3');
				}
				
				var new_kpi = kpitext;
					
				$.ajax({
					type: "post",
					data: {"kid":kid, "new_kpi":new_kpi},
				})
				.done(function(e){	
					if($(".errorMsg").hasClass("hidden")){
				
					}else{
					$(".successMsg").removeClass("hidden");
					$(".errorMsg").addClass("hidden");
					}
				})
				.fail(function(e){
					$(".errorMsg").removeClass("hidden");
				})
				.complete(function(e){
					window.setTimeout(function(){
						$(".successMsg").addClass("hidden");
					},1000);
				})
			
		
				
				
				nospace = kpitext.replace(" ","");
				$("#" + kid).text(kpitext);
				whatClass = $("#"+kid+"kpi").attr("class");
					if(whatClass == "kpioption"){
						$("#"+kid+"kpi").addClass(nospace);
					}else{
						$("#"+kid+"kpi").removeClass(whatClass);
						$("#"+kid+"kpi").addClass("clickKPI "+ nospace);
					}
				$("#"+kid+"kpi").text(kpivalue);
				
				
			});
			
			//when user hovers out of selector it disappears
			$(".kpiSelector").hover(function(){
				
			},function(){
				$(".kpiSelector").fadeOut(200);
			});
			
		});
	</script>

	<!--Sanity Check for server-->
<!-- 
	 <script>
	// 	window.setInterval(function(){
	// 			$.ajax({
	// 				type: "post",
	// 				data: {"serverCheck": "true"},
	// 			})
	// 			.done(function(e){	
	// 				if($(".errorMsg").hasClass("hidden")){
				
	// 				}else{
	// 				$(".successMsg").removeClass("hidden");
	// 				$(".errorMsg").addClass("hidden");
	// 				}
	// 			})
	// 			.fail(function(e){
	// 				$(".errorMsg").removeClass("hidden");
	// 			})
	// 			.complete(function(e){
	// 				window.setTimeout(function(){
	// 					$(".successMsg").addClass("hidden");
	// 				},1000);
	// 			})
			
	// 	}, 3000);
	 </script>
 -->
	<!--Small people to big people-->
	<script>
		$("#leadStream").delegate(".newOutboundLead","click", function(e){
			var indid=$(this).attr("id");
			
			//change photo
			var this_photo_id = "#ind_photo"+indid;
			var getPhoto = $(this_photo_id).attr("value");
			$(".bigLeadPhoto").attr("src",getPhoto);

			//change Name
			var this_name_id = "#ind_name"+indid;
			var getName = $(this_name_id).attr("value");
			$(".bigLeadName").text(getName);

			//change Location
			var this_location_id = "#ind_location"+indid;
			var getLocation = $(this_location_id).attr("value");
			$(".bigLocation").text("Location: " + getLocation);

			//change age
			var this_age_id = "#ind_age"+indid;
			var getAge = $(this_age_id).attr("value");
			$(".bigAge").text("Age: " + getAge);

			//change Website
			var this_website_id = "#ind_website"+indid;
			var getWebsite = $(this_website_id).attr("value");
			$(".bigWebsite").html("Website: <a href='http://www."+getWebsite+"' target='_blank'>"+getWebsite+"</a>");

			//change email
			var this_email_id = "#ind_email"+indid;
			var getEmail = $(this_email_id).attr("value");
			$(".bigEmail").text("Email: " + getEmail);

			//change Klout
			var this_klout_id = "#ind_klout"+indid;
			var getKlout = $(this_klout_id).attr("value");
			$(".bigKlout").text("Klout Score: " + getKlout);

			//change Social Media
			var this_fb_id = "#ind_fb"+indid;
			var getFb = $(this_fb_id).attr("value");
			var this_tw_id = "#ind_tw"+indid;
			var getTw = $(this_tw_id).attr("value");
			$("#person_tw_handle").text("@"+getTw+" tweeted:");
			var this_ln_id = "#ind_ln"+indid;
			var getLn = $(this_ln_id).attr("value");
			var sm = "";
			if(getFb!= "None" && getFb!= "null"){
				sm += '<a href="http://www.facebook.com/'+getFb+'" target="_blank"><i class="fa fa-facebook bigSmIcon"></i></a>';
			}
			if(getTw!="None" && getTw!= "null"){
				sm += '<a href="http://www.twitter.com/'+getTw+'" target="_blank"><i class="fa fa-twitter bigSmIcon"></i></a>';
			}
			if(getLn!="None" && getLn!= "null"){
				sm += '<a href="http://www.linkedin.com/'+getLn+'" target="_blank"><i class="fa fa-linkedin bigSmIcon"></i></a>';
			}
			$("#personSocialMedia").html(sm);


			//change sentiment
			var this_sentiment_id = "#ind_sentiment"+indid;
			var getSentiment = $(this_sentiment_id).attr("value");
			if(getSentiment=="No Sentiment"){
				$("#total_sentiment").text("No Sentiment");
				$("#total_sentiment").attr("class","consumerSentiment");
			}else if(getSentiment=="Positive Sentiment"){
				$("#total_sentiment").text(getSentiment);
				$("#total_sentiment").attr("class","consumerSentiment positive");
			}else if(getSentiment=="Negative Sentiment"){
				$("#total_sentiment").text(getSentiment);
				$("#total_sentiment").attr("class","consumerSentiment negative");
			}else if(getSentiment=="Neutral Sentiment"){
				$("#total_sentiment").text(getSentiment);
				$("#total_sentiment").attr("class","consumerSentiment neutral");
			}


			//change tweets
			
			var this_tweet_id ="";
			var tweet_score_id = "";
			var getTweet = "";
			var numberTweets = $("#ind_tweetNum"+ indid).attr("value");
			var myname = $("#ind_name"+indid).attr("value");
			var tweetDate = "";
			$("#tweetContainer").empty();
			for(var i = 1; i<=numberTweets; i++){
				this_tweet_id = "#"+indid+"ind_tweet"+i;
				tweet_score_id = "#"+indid+"ind_tweet_score"+i;
				tweetDate = $("#"+indid+"ind_tweet_time"+i).attr("value");
				getTweet = $(this_tweet_id).attr("value");
				getScore = $(tweet_score_id).attr("value");
				getReplyTweetId = $("#"+indid+"ind_tweet_id"+i).attr("value");
				if(getTweet != "undefined"){
					$("#tweetContainer").append("<div class='consumerSentiment consumerTweet' id='"+indid+"Tweet"+i+"'>"+getTweet+"<div class='sentimentScore' id='tweet"+i+"'><strong>Date: "+tweetDate+"</strong> | Sentiment score of "+Math.round(getScore*100)+" (Reply Now!)<i class='glyphicon glyphicon-share-alt replyTweet'></i></div></div><div class='consumerSentiment replyConsumerTweet hidden' id='hiddentweet"+i+"'><form method='post' name=tweetForm"+i+"' id='"+indid+"tweetForm"+i+"form'>{% csrf_token %}<textarea thisname="+getTw+" placeholder='Reply to this tweet to turn "+myname+" into a brand advocate!' class='negativeReplyBox' form='"+indid+"tweetForm"+i+"form' name='tweetTextArea' id='"+indid+"tweetForm"+i+"' maxlength='140'></textarea><input class='hidden' name='replyTweetId' value ='"+getReplyTweetId+"'/><button type='submit' class='whiteBtn tier5-btn sendTweetBtn' id='"+indid+"tweetBtn"+i+"sendTweet'>Send Tweet</button></form></div>");
				}
				if(getScore > 0){
					$("#"+indid+"Tweet"+i).addClass("positive");
				}else if(getScore < 0){
					$("#"+indid+"Tweet"+i).addClass("negative");
				}else{
					$("#"+indid+"Tweet"+i).addClass("neutral");
				}
				if(i==10){
					break;
				}
			}
		});

		$(".consumer").on("click", function(e){
			var indid=$(this).attr("id");
			
			//change photo
			var this_photo_id = "#cind_photo"+indid;
			var getPhoto = $(this_photo_id).attr("value");
			$(".bigLeadPhoto").attr("src",getPhoto);

			//change Name
			var this_name_id = "#cind_name"+indid;
			var getName = $(this_name_id).attr("value");
			$(".bigLeadName").text(getName);

			//change Location
			var this_location_id = "#cind_location"+indid;
			var getLocation = $(this_location_id).attr("value");
			$(".bigLocation").text("Location: " + getLocation);

			//change age
			var this_age_id = "#cind_age"+indid;
			var getAge = $(this_age_id).attr("value");
			$(".bigAge").text("Age: " + getAge);

			//change Website
			var this_website_id = "#cind_website"+indid;
			var getWebsite = $(this_website_id).attr("value");
			$(".bigWebsite").html("Website: <a href='http://www."+getWebsite+"' target='_blank'>"+getWebsite+"</a>");

			//change email
			var this_email_id = "#cind_email"+indid;
			var getEmail = $(this_email_id).attr("value");
			$(".bigEmail").text("Email: " + getEmail);

			//change Klout
			var this_klout_id = "#cind_klout"+indid;
			var getKlout = $(this_klout_id).attr("value");
			$(".bigKlout").text("Klout Score: " + getKlout);

			//change Social Media
			var this_fb_id = "#cind_fb"+indid;
			var getFb = $(this_fb_id).attr("value");
			var this_tw_id = "#cind_tw"+indid;
			var getTw = $(this_tw_id).attr("value");
			$("#person_tw_handle").text("@"+getTw+" tweeted:");
			var this_ln_id = "#cind_ln"+indid;
			var getLn = $(this_ln_id).attr("value");
			var sm = "";
			if(getFb!= "None"){
				sm += '<a href="http://www.facebook.com/'+getFb+'" target="_blank"><i class="fa fa-facebook bigSmIcon"></i></a>';
			}
			if(getTw!="None"){
				sm += '<a href="http://www.twitter.com/'+getTw+'" target="_blank"><i class="fa fa-twitter bigSmIcon"></i></a>';
			}
			if(getLn!="None"){
				sm += '<a href="http://www.linkedin.com/'+getLn+'" target="_blank"><i class="fa fa-linkedin bigSmIcon"></i></a>';
			}
			$("#personSocialMedia").html(sm);

			//change sentiment
			var this_sentiment_id = "#ind_sentiment"+indid;
			var getSentiment = $(this_sentiment_id).attr("value");
			if(getSentiment==""){
				$("#total_sentiment").text("No Sentiment");
				$("#total_sentiment").attr("class","consumerSentiment");
			}else if(getSentiment=="Positive Sentiment"){
				$("#total_sentiment").text(getSentiment);
				$("#total_sentiment").attr("class","consumerSentiment positive");
			}else if(getSentiment=="Negative Sentiment"){
				$("#total_sentiment").text(getSentiment);
				$("#total_sentiment").attr("class","consumerSentiment negative");
			}else if(getSentiment=="Neutral Sentiment"){
				$("#total_sentiment").text(getSentiment);
				$("#total_sentiment").attr("class","consumerSentiment neutral");
			}

			//change tweets
			
			var this_tweet_id ="";
			var tweet_score_id = "";
			var getTweet = "";
			var numberTweets =$("#ind_tweetNum"+ indid).attr("value");
			var myname = $("#ind_name"+indid).attr("value");
			var tweetDate = "";
			$("#tweetContainer").empty();
			for(var i = 1; i<=numberTweets; i++){
				this_tweet_id = "#c"+indid+"ind_tweet"+i;
				tweet_score_id = "#c"+indid+"ind_tweet_score"+i;
				tweetDate = $("#c"+indid+"ind_tweet_time"+i).attr("value");
				getTweet = $(this_tweet_id).attr("value");
				getScore = $(tweet_score_id).attr("value");
				getReplyTweetId = $("#c"+indid+"ind_tweet_id"+i).attr("value");
				if(getTweet != "undefined"){
					$("#tweetContainer").append("<div class='consumerSentiment consumerTweet' id='"+indid+"Tweet"+i+"'>"+getTweet+"<div class='sentimentScore' id='tweet"+i+"'><strong>Date: "+tweetDate+"</strong> | Sentiment score of "+Math.round(getScore*100)+" (Reply Now!)<i class='glyphicon glyphicon-share-alt replyTweet'></i></div></div><div class='consumerSentiment replyConsumerTweet hidden' id='hiddentweet"+i+"'><form method='post' name=tweetForm"+i+"' id='"+indid+"tweetForm"+i+"form'>{% csrf_token %}<textarea thisname="+getTw+" placeholder='Reply to this tweet to turn "+myname+" into a brand advocate!' class='negativeReplyBox' form='"+indid+"tweetForm"+i+"form' name='tweetTextArea' id='"+indid+"tweetForm"+i+"' maxlength='140'></textarea><input class='hidden' name='replyTweetId' value ='"+getReplyTweetId+"'/><button type='submit' class='whiteBtn tier5-btn sendTweetBtn' id='"+indid+"tweetBtn"+i+"sendTweet'>Send Tweet</button></form></div>");
				}
				if(getScore > 0){
					$("#"+indid+"Tweet"+i).addClass("positive");
				}else if(getScore < 0){
					$("#"+indid+"Tweet"+i).addClass("negative");
				}else{
					$("#"+indid+"Tweet"+i).addClass("neutral");
				}
				if(i==5){
					break;
				}
			}
		});
	</script>
	
	<!-- Line graph -->
    <script>
	    	$(document).ready(function () {
				$(".non_main").on({
					mouseover: function () {
						$(this).css("opacity", "1");
						$(".main").css("opacity", ".2");
					},
					mouseout: function () {
						$(this).css("opacity", ".2");
						$(".main").css("opacity", "1");
					}
				})
	    	});
		    var margin = {top: 20, right: 80, bottom: 30, left: 50},
		        width = 1090 - margin.left - margin.right,
		        height = 230 - margin.top - margin.bottom;

		    var parseDate = d3.time.format("%m/%d/%y").parse;
		    var date_format = d3.time.format("%b %d");

		    var x = d3.time.scale()
		        .range([0, width]);

		    var y = d3.scale.linear()
		        .range([height, 0]);

		    var xAxis = d3.svg.axis()
		    .scale(x)
		    .orient("bottom")
		    .ticks(10)
		    .tickFormat(date_format);

		    var yAxis = d3.svg.axis()
		        .scale(y)
		        .orient("left")
		        .tickFormat("");

		    var line_green = d3.svg.line()
		        .x(function (d) {
		            return d.x;
		        })
		        .y(function (d) {
		            return d.y;
		        })
		    
		    var line_red = d3.svg.line()
		        .x(function (d) {
		            return d.x;
		        })
		        .y(function (d) {
		            return d.y;
		        })

		    var line_black = d3.svg.line().x(function (d) {
		        return d.x;
		    }).y(function (d) {
		        return d.y;
		    })

		    //svg for the graph
		    var svg = d3.select("#sentimentPage>.d3GraphContainer").append("svg")
		        .attr("width", width + margin.left + margin.right)
		        .attr("height", height + margin.top + margin.bottom)
		        .append("g")
		        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		    
		    // Add the clip path
		    svg.append("clipPath")
		        .attr("id", "clip")
		        .append("rect")
		        .attr("width", width)
		        .attr("height", height);

		    //data(json) from sinan

		    data = {"{{request.session.30.me.company_name}}": [{% for sentiment in request.session.30.me.sentiments %}  { "date": "{{sentiment.0}}", "score": {{sentiment.1}} }, {% endfor %}]	,
				{% for competitor in request.session.30.competitors %}
				"{{competitor.company_cleaned_name}}": [{% for sentiment in competitor.sentiments %}  { "date": "{{sentiment.0}}", "score": {{sentiment.1}} }, {% endfor %}],
				{% endfor %}};
			    var co1 = "{{request.session.30.me.company_name}}"; //add django here, (main company)
			    var co2 = "{{request.session.30.competitors.0.company_cleaned_name}}"; //add django here (competitors/ if none, just leave it as blank)
			    var co3 = "{{request.session.30.competitors.1.company_cleaned_name}}"; //add django here (competitors/ if none, just leave it as blank)
			    var co4 = "{{request.session.30.competitors.2.company_cleaned_name}}"; //add django here (competitors/ if none, just leave it as blank)
				
				$(document).ready(function(){
					if(co2 !== ""){
						$("#comp2").html("{{request.session.30.competitors.0.company_name}}"+' <div class="companyCheckbox" id="checkbox2"><i class="fa fa-check checked hidden"></i></div>');
					}if(co3 !==""){
						$("#comp3").html("{{request.session.30.competitors.1.company_name}}"+' <div class="companyCheckbox" id="checkbox3"><i class="fa fa-check checked hidden"></i></div>');
					}if(co4 !==""){
						$("#comp4").html("{{request.session.30.competitors.2.company_name}}"+' <div class="companyCheckbox" id="checkbox4"><i class="fa fa-check checked hidden"></i></div>');
					}
				});
			var co1_checked = true; //checked data from jamasen
		    var co2_checked = true; //checked data from jamasen
		    var co3_checked = true; //checked data from jamasen
		    var co4_checked = true; //checked data from jamasen
			//this is the checkbox for the line graph	
				
			$(".compName").on("click",function(e){
				e.stopPropagation();
				var thisid=$(this).attr("id");
				$("#"+thisid+">.companyCheckbox>.checked").toggleClass("hidden");
				var hasthisclass=$("#"+thisid+">.companyCheckbox>.checked").attr("class");
				if(hasthisclass == "fa fa-check checked hidden"){
					if(thisid == "comp2"){
						$("#"+co2).css("display","none");
					}else if(thisid == "comp3"){
						$("#"+co3).css("display","none");
					}else{
						$("#"+co4).css("display","none");
					}
				}else{
					if(thisid == "comp2"){
						$("#"+co2).css("display","block");
					}else if(thisid == "comp3"){
						$("#"+co3).css("display","block");
					}else{
						$("#"+co4).css("display","block");
					}
				}
			});
				
			//checkbox1
			//end of checkbox code
		   

		    var co1_logo = "{{request.user.twitter_picture}}"; //need sources
		    var co2_logo = "{{request.session.30.competitors.0.company_logo}}"
		    var co3_logo = "{{request.session.30.competitors.1.company_logo}}"
		    var co4_logo = "{{request.session.30.competitors.2.company_logo}}"


		    var company_names = [co1, co2, co3, co4]; //hold names of company
		    // var real_company_names = [co1, co2, co3, co4]; //hold names of company
		    var company_checks = [co1_checked, co2_checked, co3_checked, co4_checked]; //hold checked variables of company
		    var company_logos = [co1_logo, co2_logo, co3_logo, co4_logo]; //hold logos of company

		    var period = 30; // input from the user, request from jamasen
		    var total_days = data[co1].length; // total days of the input data

		    var company_values = new Array(); // array to hold all company values 
		    var values = new Array(period); // array to parse the exact period of data   
		    var j; // value for index

		    // store the exact period of data for each company from Starting date to Today's date 
		    for (var i = 0; i < company_names.length; i++) {
		        if (company_names[i].length != 0) {
		            j = 0;
		            for (var start_date = total_days - period; start_date < total_days; start_date++) {
		                values[j] = { "date": parseDate(data[company_names[i]][start_date]["date"]), "score": +data[company_names[i]][start_date]["score"] };
		                j++;
		            }
		            company_values[i] = values;
		            values = new Array(period);
		        }
		    }

		    var green_coordinates = new Array(); //array to hold all green_coordinates of the path
		    var red_coordinates = new Array(); //array to hold all red_coordinates of the path
		    var black_coordinates = new Array(); //array to hold all black_coordinates of the path

		    var companies = new Array(); //array to hold dictionary of each company data ex(main:"", isChecked:"", values:"", green_cords:"", red_cords:"", black_cords:"")

		    // get the exact chordinates of lines for each company
		    for (var k = 0; k < company_names.length; k++) {
		        if (company_names[k].length != 0) {
		            var count = 0;
		            for (var i = total_days - period; i < total_days - 1; i++) {
		                j = i + 1;
		                var y1_raw = data[company_names[k]][i]["score"];
		                var y2_raw = data[company_names[k]][j]["score"];

		                //actual coordinates of x,y in pixel
		                var y1_cord = height / 2 * y1_raw;
		                var y2_cord = height / 2 * y2_raw;
		                var x1_cord = width / (period - 1) * count;
		                var x2_cord = width / (period - 1) * (count + 1);

		                //finding x intersection
		                var dy = y2_cord - y1_cord;
		                var dx = x2_cord - x1_cord;
		                var slope = dy / dx;
		                var x_intsect = y1_cord / (-slope);

		                var green_cords = new Array(2);
		                var red_cords = new Array(2);
		                var black_cords = new Array(2);

		                // if point A and point B crosses the x-axis
		                if ((y1_raw > 0 && y2_raw < 0) || (y1_raw < 0 && y2_raw > 0)) {
		                    //find x intersection [{x1,y1}, {x2,y2}]            
		                    //store coordinates
		                    if (y1_raw > 0) {
		                        green_cords[0] = { "x": x1_cord, "y": height / 2 - y1_cord }; // [x, y intersection]
		                        green_cords[1] = { "x": x_intsect + x1_cord, "y": height / 2 }; // [x intersection, 225]
		                        red_cords[0] = { "x": x_intsect + x1_cord, "y": height / 2 };
		                        red_cords[1] = { "x": x2_cord, "y": height / 2 - y2_cord };
		                    } else {
		                        green_cords[0] = { "x": x_intsect + x1_cord, "y": height / 2 }; // [x intersection, 225]
		                        green_cords[1] = { "x": x2_cord, "y": height / 2 - y2_cord }; // [x, y]
		                        red_cords[0] = { "x": x1_cord, "y": height / 2 - y1_cord };
		                        red_cords[1] = { "x": x_intsect + x1_cord, "y": height / 2 };
		                    }
		                    green_coordinates.push(green_cords);
		                    red_coordinates.push(red_cords);
		                }
		                    // if point A is on the axis and point B is above
		                    // or
		                    // if both points are positive
		                else if ((y1_raw == 0 && y2_raw > 0) || (y1_raw > 0 && y2_raw > 0) || (y1_raw > 0 && y2_raw == 0)) {
		                    //store both coordinates (ex. a[x,y] and b[x,y])        
		                    if (y1_raw == 0) {
		                        green_cords[0] = { "x": x1_cord, "y": height / 2 };
		                        green_cords[1] = { "x": x2_cord, "y": height / 2 - y2_cord };
		                    } else if (y2_raw == 0) {
		                        green_cords[0] = { "x": x1_cord, "y": height / 2 - y1_cord };
		                        green_cords[1] = { "x": x2_cord, "y": height / 2 };
		                    } else {
		                        green_cords[0] = { "x": x1_cord, "y": height / 2 - y1_cord };
		                        green_cords[1] = { "x": x2_cord, "y": height / 2 - y2_cord };
		                    }
		                    green_coordinates.push(green_cords);
		                }
		                else if ((y1_raw == 0 && y2_raw < 0) || (y1_raw < 0 && y2_raw < 0) || (y1_raw < 0 && y2_raw == 0)) {
		                    if (y1_raw == 0) {
		                        red_cords[0] = { "x": x1_cord, "y": height / 2 };
		                        red_cords[1] = { "x": x2_cord, "y": height / 2 - y2_cord };
		                    } else if (y2_raw == 0) {
		                        red_cords[0] = { "x": x1_cord, "y": height / 2 - y1_cord };
		                        red_cords[1] = { "x": x2_cord, "y": height / 2 };
		                    } else {
		                        red_cords[0] = { "x": x1_cord, "y": height / 2 - y1_cord };
		                        red_cords[1] = { "x": x2_cord, "y": height / 2 - y2_cord };
		                    }
		                    red_coordinates.push(red_cords);
		                }
		                else if (y1_raw == 0 && y2_raw == 0) {
		                    black_cords[0] = { "x": x1_cord, "y": height / 2 };
		                    black_cords[1] = { "x": x2_cord, "y": height / 2 };
		                    black_coordinates.push(black_cords);
		                }
		                count++;
		            }
		            var isMain = false;
		            if (k == 0) {
		                isMain = true;
		            }
		            companies.push({ "main": isMain, "isChecked": company_checks[k], "name": company_names[k], "values": company_values[k], "logo": company_logos[k], "green_cords": green_coordinates, "red_cords": red_coordinates, "black_cords": black_coordinates });
		            green_coordinates = new Array();
		            red_coordinates = new Array();
		            black_coordinates = new Array();
		        }
		    }

		    x.domain(d3.extent(companies[0]["values"], function (d) { return d["date"]; })); // set the domain of the x axis
		    y.domain([-1, 1]); // set the range of the y axis
		    
		    // append x axis to svg
		    svg.append("g")
		        .attr("class", "x axis")
		        .attr("transform", "translate(0," + height + ")")
		        .call(xAxis);

		    // append y axis to svg
		    svg.append("g")
		        .attr("class", "y axis")
		        .call(yAxis);

		    var company_1; // variable to contain first(main) company's paths
		    var company_2; // variable to contain second(competitor) company's paths
		    var company_3; // variable to contain third(competitor) company's paths
		    var company_4; // variable to contain fourth(competitor) company's paths
		    var company_classes = [company_1, company_2, company_3, company_4]; // array to hold all company-classes
			var space = 0;
		    //for each company, append its corresponding paths(green, red, black)
		    // no path will be created if the graph is not checked
		    // var last_scores = [companies[0].values[period - 1]["score"], companies[1].values[period - 1]["score"], companies[2].values[period - 1]["score"]];
		    var logos = [companies[0].values[period-1]]
		    var temp;

		    for (var i = 0; i < companies.length - 1; i++) {
		        if (companies[i].isChecked == true) {
		            for (var j = i + 1; j < companies.length; j++) {
		                if (companies[j].isChecked == true) {
		                    if (companies[i].values[period - 1]["score"] < companies[j].values[period - 1]["score"]) {
		                        temp = companies[i];
		                        companies[i] = companies[j];
		                        companies[j] = temp;
		                    }
		                }
		            }
		        }
		    }

		    for (var i = 0; i < companies.length; i++) {
		        if (companies[i].isChecked == true) {
		            company_classes[i] = svg.append("g").attr("class", function (){
		                if (companies[i].main == true){
		                    return "main";
		                }else{
		                    return "non_main"
		                }
		            }).attr("id", companies[i].name);

		            for (var j = 0; j < companies[i].green_cords.length; j++) {
		                company_classes[i].append("path")
		                .attr("class", "line_green")
		                .attr("d", function (d) { return line_green(companies[i].green_cords[j]) })
		            }
		            for (var j = 0; j < companies[i].red_cords.length; j++) {
		                company_classes[i].append("path")
		                .attr("class", "line_red")
		                .attr("d", function (d) { return line_red(companies[i].red_cords[j]) })
		            }
		            for (var j = 0; j < companies[i].black_cords.length; j++) {
		                company_classes[i].append("path")
		                .attr("class", "line_black")
		                .attr("d", function (d) { return line_black(companies[i].black_cords[j]) })
		            }
		        }
		    }

		    var score_diff;
		    var logo_cords = new Array();
		    var g = 30;
		    var min = 160;
		    if (companies.length == 2) {
		        min = 130;
		    } else if (companies.length == 3) {
		        min = 100;
		    } else if (companies.length == 4) {
		        min = 70;
		    }

		    for (var i = 0; i < companies.length; i++) {
		        if (companies[i].isChecked == true) {
		            if (i == 0) {
		                company_classes[i].append("svg:image")
		                    .datum(function (d) { return { name: companies[i].name, value: companies[i].values[period - 1], logo: companies[i].logo }; })
		                    .attr("class", "floating_graph_logo")
		                    .attr("transform", function (d) {
		                        if (y(d.value.score) > min) {
		                            p = min;
		                        } else {
		                            p = y(d.value.score);
		                        }
		                        logo_cords.push(p);
		                        return "translate(" + x(d.value.date) + "," + p + ")";
		                    })
		                    .attr("xlink:href", function (d) { return d.logo; })
		                    .attr("x", 3)
		                    .attr("y", -10)
		                    .attr("width", 30)
		                    .attr("height", 30);
		            } else {
		                company_classes[i].append("svg:image")
		                    .datum(function (d) { return { name: companies[i].name, value: companies[i].values[period - 1], logo: companies[i].logo }; })
		                    .attr("class", "floating_graph_logo")
		                    .attr("transform", function (d) {
		                        if (y(d.value.score) > min + (g*i)) {
		                            p = min + (g * i);
		                        } else {
		                            if (y(d.value.score) <= (logo_cords[i-1] + 30)) {
		                                p = logo_cords[i - 1] + 30;
		                            } else {
		                                p = y(d.value.score);
		                            }
		                        }
		                        logo_cords.push(p);
		                        return "translate(" + x(d.value.date) + "," + p + ")";
		                    })
		                    .attr("xlink:href", function (d) { return d.logo; })
		                    .attr("x", 3)
		                    .attr("y", -10)
		                    .attr("width", 30)
		                    .attr("height", 30);
		            }
		        }
		    }
		    
		    // Add 'curtain' rectangle to hide entire graph
		    var curtain = svg.append('rect')
		        .attr('x', -1 * (width+40))
		        .attr('y', -1 * height)
		        .attr('height', height)
		        .attr('width', (width+40))
		        .attr('class', 'curtain')
		        .attr('transform', 'rotate(180)')
		        .style('fill', '#f8f8f8')
		    
		    // append x-axis line in the middle of the graph
		    svg.append("g")
		        .append("line")
		        .attr("x1", 0)
		        .attr("y1", height / 2)
		        .attr("x2", width)
		        .attr("y2", height / 2)
		        .attr("stroke-width", 1.5)
		        .attr("stroke", "#C5C5C5");

		    // Create a shared transition for any animation
		    var t = svg.transition()
		        .delay(500)
		        .duration(4000)
		        .ease('cubic-in-out')
		        .each('end', function () {
		            d3.select('line.guide')
		                .transition()
		                .style('opacity', 0)
		                .remove()
		        });

		    t.select('rect.curtain').attr('width', 0);
			
				
			//	// jquery for hover over the box
			//	var box_id;
			//	var line_id;
			//	var percent_id;
			//	$(".eventBox").mouseover(function(){
			//	   box_id = $(this).attr("id");
			//	   line_id = box_id.replace("Box", "Line");
			//	   percent_id = box_id.replace("Box", "Percent");
			//	   $("#"+line_id).show();
			//	   $("#"+percent_id).show();       
			//	})    
			//	$(".eventBox").mouseout(function(){
			//	   $("#"+line_id).hide();
			//	   $("#"+percent_id).hide();       
			//	})    
			//
			//	// general variables for event
			//	var event_id;
			//	var event_date;
			//	var event_percent;
			//	var event_xcord;
			//
			//	
			//	//whenever a user creates an event, this should happpen also
			//	//Event A
			//	event_id = 'A';
			//	event_date = '7/10/2015';
			//	event_percent = '-136%';
			//	letter_size = event_percent.length;
			//	event_xcord = x(parseDate(event_date));
			//	$("#eventBox_"+ event_id).css({
			//	   left : (event_xcord + 52.5) + "px"
			//	});
			//	$("#eventBox_"+ event_id).text(event_id);
			//	$("#eventLine_"+ event_id).css({
			//	   left : (event_xcord + 60) + "px"
			//	});
			//	$("#eventPercent_"+ event_id).css({
			//	   left : (event_xcord + 68) + "px",
			//	   width : (letter_size * 10) + "px"
			//	})
			//	$("#eventPercent_"+ event_id).text(event_percent);
    </script>

	<!-- Social media Graph -->
	<script>

		// json data of distribution of age_range
		var data = [{ "social_media": "Facebook", "value": {{request.session.inbound_stats.social_medias.Facebook}} }, { "social_media": "Twitter", "value": {{request.session.inbound_stats.social_medias.Twitter}} }, { "social_media": "Linkedin", "value": {{request.session.inbound_stats.social_medias.Linkedin}} }, { "social_media": "Angelist", "value": {{request.session.inbound_stats.social_medias.Angellist}} }];
		// array to hold values
		var values = [];
		// initial max value
		var max = 0;
		// run through the data and extract store values in values and find max value
		for (var i = 0; i < data.length; i++) {
			values.push(data[i]["value"]);
			if (data[i]["value"] >= max) {
				max = data[i]["value"];
			}
		}

		// width and barHeight
		var width = 363,
			height = 200,
			barHeight = (height) / data.length;

		// range & domain of x
		var x = d3.scale.linear()
		.domain([0, d3.max(values)])
		.range([0, width-150]);

		// chart property
		var chart = d3.select(".sm-chart")
				.attr("width", width)
				.attr("height", barHeight * data.length);

		// bar property
		var bar = chart.selectAll("g")
				.data(values)
				.enter().append("g")
				.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
				.attr("class", function (d) {
					if (d == max) { return "max"; }
					else {
						return "non_max";
					}
				});

		// append each rect with its with of x
		bar.append("rect")
			.attr("height", function () { return barHeight - 5; })
			.attr("width", x);

		// append social_media next to each bar
		bar.append("text")
			.attr("x", function (d) { return x(d) + 15; })
			.data(data)
			.attr("y", barHeight / 2)
			.attr("dy", ".25em")
			.text(function (d) { return d.social_media; });

		// append "Social" on the left of the graph
		chart.append("text")
			.attr("x", 20)
			.attr("y", barHeight * data.length / 2 - 8)
			.attr("text-anchor", "center")
			.text("Social");

		// append "Media" on the left of the graph
		chart.append("text")
			.attr("x", 20)
			.attr("text-anchor", "center")
			.attr("y", barHeight * data.length / 2 + 8)
			.text("Media");

		$(".mainCompany").on("click",function(){
				var sid = $(".currentComp").attr("id");
				$(".sm-chart").empty();
				if(sid == "slide1"){
					var data = [{ "social_media": "Facebook", "value": {{request.session.inbound_stats.social_medias.Facebook}} }, { "social_media": "Twitter", "value": {{request.session.inbound_stats.social_medias.Twitter}} }, { "social_media": "Linkedin", "value": {{request.session.inbound_stats.social_medias.Linkedin}} }, { "social_media": "Angelist", "value": {{request.session.inbound_stats.social_medias.Facebook}} }];
					// array to hold values
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data.length; i++) {
						values.push(data[i]["value"]);
						if (data[i]["value"] >= max) {
							max = data[i]["value"];
						}
					}

					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = (height) / data.length;

					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);

					// chart property
					var chart = d3.select(".sm-chart")
							.attr("width", width)
							.attr("height", barHeight * data.length);

					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});

					// append each rect with its with of x
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);

					// append social_media next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.social_media; });

					// append "Social" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Social");

					// append "Media" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data.length / 2 + 8)
						.text("Media");
					
				}else if(sid == "slide2"){
					{% if request.session.30.competitors.0 %}
					var data1 = [{ "social_media": "Facebook", "value": {{request.session.30.competitors.0.demographics.social_medias.Facebook}} }, { "social_media": "Twitter", "value": {{request.session.30.competitors.0.demographics.social_medias.Twitter}} }, { "social_media": "Linkedin", "value": {{request.session.30.competitors.0.demographics.social_medias.Linkedin}} }, { "social_media": "Angelist", "value": {{request.session.30.competitors.0.demographics.social_medias.Angellist}} }];
					 {%else%}
					 var data1 = [{ "social_media": "Facebook", "value": 0 }, { "social_media": "Twitter", "value": 0 }, { "social_media": "Linkedin", "value": 0 }, { "social_media": "Angelist", "value": 0 }];
					  {%endif%}
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data1.length; i++) {
						values.push(data1[i]["value"]);
						if (data1[i]["value"] >= max) {
							max = data1[i]["value"];
						}
					}

					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = (height) / data1.length;

					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);

					// chart property
					var chart = d3.select(".sm-chart")
							.attr("width", width)
							.attr("height", barHeight * data1.length);

					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});

					// append each rect with its with of x
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);

					// append social_media next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data1)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.social_media; });

					// append "Social" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data1.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Social");

					// append "Media" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data1.length / 2 + 8)
						.text("Media");
					
				}else if(sid == "slide3"){
					
					{% if request.session.30.competitors.1 %}
					var data2 = [{ "social_media": "Facebook", "value": {{request.session.30.competitors.1.demographics.social_medias.Facebook}} }, { "social_media": "Twitter", "value": {{request.session.30.competitors.1.demographics.social_medias.Twitter}} }, { "social_media": "Linkedin", "value": {{request.session.30.competitors.1.demographics.social_medias.Linkedin}} }, { "social_media": "Angelist", "value": {{request.session.30.competitors.1.demographics.social_medias.Angellist}} }];
					 {%else%}
					 var data2 = [{ "social_media": "Facebook", "value": 0 }, { "social_media": "Twitter", "value": 0 }, { "social_media": "Linkedin", "value": 0 }, { "social_media": "Angelist", "value": 0 }];
					  {%endif%}
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data2.length; i++) {
						values.push(data2[i]["value"]);
						if (data2[i]["value"] >= max) {
							max = data2[i]["value"];
						}
					}

					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = (height) / data2.length;

					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);

					// chart property
					var chart = d3.select(".sm-chart")
							.attr("width", width)
							.attr("height", barHeight * data2.length);

					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});

					// append each rect with its with of x
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);

					// append social_media next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data2)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.social_media; });

					// append "Social" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data2.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Social");

					// append "Media" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data2.length / 2 + 8)
						.text("Media");
					
				}else if(sid == "slide4"){
					
					{% if request.session.30.competitors.2 %}
					var data3 = [{ "social_media": "Facebook", "value": {{request.session.30.competitors.2.demographics.social_medias.Facebook}} }, { "social_media": "Twitter", "value": {{request.session.30.competitors.2.demographics.social_medias.Twitter}} }, { "social_media": "Linkedin", "value": {{request.session.30.competitors.2.demographics.social_medias.Linkedin}} }, { "social_media": "Angelist", "value": {{request.session.30.competitors.2.demographics.social_medias.Angellist}} }];
					 {%else%}
					 var data3 = [{ "social_media": "Facebook", "value": 0 }, { "social_media": "Twitter", "value": 0 }, { "social_media": "Linkedin", "value": 0 }, { "social_media": "Angelist", "value": 0 }];
					  {%endif%}
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data3.length; i++) {
						values.push(data3[i]["value"]);
						if (data3[i]["value"] >= max) {
							max = data3[i]["value"];
						}
					}

					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = (height) / data3.length;

					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);

					// chart property
					var chart = d3.select(".sm-chart")
							.attr("width", width)
							.attr("height", barHeight * data3.length);

					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});
					// append each rect with its with of x
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);

					// append social_media next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data3)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.social_media; });

					// append "Social" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data3.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Social");

					// append "Media" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data3.length / 2 + 8)
						.text("Media");
				}
		});
	</script>

	<!--age graph -->
	<script>
		// json data of distribution of age_range
		var data = [{ "age_range": "15-20", "value": {{request.session.inbound_stats.ages.20}} }, { "age_range": "20-25", "value": {{request.session.inbound_stats.ages.25}} }, { "age_range": "25-30", "value": {{request.session.inbound_stats.ages.30}} }, { "age_range": "30-35", "value": {{request.session.inbound_stats.ages.35}} }, { "age_range": "35-40", "value": {{request.session.inbound_stats.ages.40}} }];

		// array to hold values
		var values = [];
		// initial max value
		var max = 0;
		// run through the data and extract store values in values and find max value
		for (var i = 0; i < data.length; i++) {
			values.push(data[i]["value"]);
			if (data[i]["value"] >= max) {
				max = data[i]["value"];
			}
		}
		// width and barHeight
		var width = 363,
			height = 200,
			barHeight = height / data.length;
		// range & domain of x
		var x = d3.scale.linear()
		.domain([0, d3.max(values)])
		.range([0, width-150]);
		// chart property
		var chart = d3.select(".age-chart")
				.attr("width", width)
				.attr("height", barHeight * data.length);
		// bar property
		var bar = chart.selectAll("g")
				.data(values)
				.enter().append("g")
				.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
				.attr("class", function (d) {
					if (d == max) { return "max"; }
					else {
						return "non_max";
					}
				});
		// append each rect with its with of x                         
		bar.append("rect")
			.attr("height", function () { return barHeight - 5; })
			.attr("width", x);
		// append age next to each bar
		bar.append("text")
			.attr("x", function (d) { return x(d) + 15; })
			.data(data)
			.attr("y", barHeight / 2)
			.attr("dy", ".25em")
			.text(function (d) { return d.age_range; });
		// append "Age" on the left of the graph
		chart.append("text")
			.attr("x", 20)
			.attr("y", barHeight * data.length / 2 - 8)
			.attr("text-anchor", "center")
			.text("Age");
		// append "Range" on the left of the graph
		chart.append("text")
			.attr("x", 12)
			.attr("text-anchor", "center")
			.attr("y", barHeight * data.length / 2 + 8)
			.text("Range");
		$(".mainCompany").on("click",function(){
				var sid = $(".currentComp").attr("id");
				$(".age-chart").empty();
				if(sid == "slide1"){
					var data = [{ "age_range": "15-20", "value": {{request.session.inbound_stats.ages.20}} }, { "age_range": "20-25", "value": {{request.session.inbound_stats.ages.25}} }, { "age_range": "25-30", "value": {{request.session.inbound_stats.ages.30}} }, { "age_range": "30-35", "value": {{request.session.inbound_stats.ages.35}} }, { "age_range": "35-40", "value": {{request.session.inbound_stats.ages.40}} }];
					// array to hold values
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data.length; i++) {
						values.push(data[i]["value"]);
						if (data[i]["value"] >= max) {
							max = data[i]["value"];
						}
					}
					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = height / data.length;
					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);
					// chart property
					var chart = d3.select(".age-chart")
							.attr("width", width)
							.attr("height", barHeight * data.length);
					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});
					// append each rect with its with of x                         
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);
					// append age next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.age_range; });
					// append "Age" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Age");
					// append "Range" on the left of the graph
					chart.append("text")
						.attr("x", 12)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data.length / 2 + 8)
						.text("Range");
				 	
				}else if(sid=="slide2"){
					{% if request.session.30.competitors.0%}
					var data1 = [{ "age_range": "15-20", "value": {{request.session.30.competitors.0.demographics.ages.20}} }, { "age_range": "20-25", "value": {{request.session.30.competitors.0.demographics.ages.25}} }, { "age_range": "25-30", "value": {{request.session.30.competitors.0.demographics.ages.30}} }, { "age_range": "30-35", "value": {{request.session.30.competitors.0.demographics.ages.35}} }, { "age_range": "35-40", "value": {{request.session.30.competitors.0.demographics.ages.40}} }];
					 {%else%}
					 var data1 = [{ "age_range": "15-20", "value":0 }, { "age_range": "20-25", "value": 0 }, { "age_range": "25-30", "value": 0 }, { "age_range": "30-35", "value": 0 }, { "age_range": "35-40", "value": 0 }];
					  {%endif%}
					// array to hold values
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data1.length; i++) {
						values.push(data1[i]["value"]);
						if (data1[i]["value"] >= max) {
							max = data1[i]["value"];
						}
					}
					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = height / data1.length;
					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);
					// chart property
					var chart = d3.select(".age-chart")
							.attr("width", width)
							.attr("height", barHeight * data1.length);
					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});
					// append each rect with its with of x                         
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);
					// append age next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data1)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.age_range; });
					// append "Age" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data1.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Age");
					// append "Range" on the left of the graph
					chart.append("text")
						.attr("x", 12)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data1.length / 2 + 8)
						.text("Range");
				}else if(sid=="slide3"){
					{% if request.session.30.competitors.1%}
					var data2 = [{ "age_range": "15-20", "value": {{request.session.30.competitors.1.demographics.ages.20}} }, { "age_range": "20-25", "value": {{request.session.30.competitors.1.demographics.ages.25}} }, { "age_range": "25-30", "value": {{request.session.30.competitors.1.demographics.ages.30}} }, { "age_range": "30-35", "value": {{request.session.30.competitors.1.demographics.ages.35}} }, { "age_range": "35-40", "value": {{request.session.30.competitors.1.demographics.ages.40}} }];
					 {%else%}
					 var data2 = [{ "age_range": "15-20", "value":0 }, { "age_range": "20-25", "value": 0 }, { "age_range": "25-30", "value": 0 }, { "age_range": "30-35", "value": 0 }, { "age_range": "35-40", "value": 0 }];
					  {%endif%}
					// array to hold values
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data2.length; i++) {
						values.push(data2[i]["value"]);
						if (data2[i]["value"] >= max) {
							max = data2[i]["value"];
						}
					}
					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = height / data2.length;
					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);
					// chart property
					var chart = d3.select(".age-chart")
							.attr("width", width)
							.attr("height", barHeight * data2.length);
					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});
					// append each rect with its with of x                         
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);
					// append age next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data2)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.age_range; });
					// append "Age" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data2.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Age");
					// append "Range" on the left of the graph
					chart.append("text")
						.attr("x", 12)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data2.length / 2 + 8)
						.text("Range");
				}else if(sid=="slide4"){
					{% if request.session.30.competitors.2%}
					var data3 = [{ "age_range": "15-20", "value": {{request.session.30.competitors.2.demographics.ages.20}} }, { "age_range": "20-25", "value": {{request.session.30.competitors.2.demographics.ages.25}} }, { "age_range": "25-30", "value": {{request.session.30.competitors.2.demographics.ages.30}} }, { "age_range": "30-35", "value": {{request.session.30.competitors.2.demographics.ages.35}} }, { "age_range": "35-40", "value": {{request.session.30.competitors.2.demographics.ages.40}} }];
					 {%else%}
					 var data3 = [{ "age_range": "15-20", "value":0 }, { "age_range": "20-25", "value": 0 }, { "age_range": "25-30", "value": 0 }, { "age_range": "30-35", "value": 0 }, { "age_range": "35-40", "value": 0 }];
					  {%endif%}
					// array to hold values
					var values = [];
					// initial max value
					var max = 0;
					// run through the data and extract store values in values and find max value
					for (var i = 0; i < data3.length; i++) {
						values.push(data3[i]["value"]);
						if (data3[i]["value"] >= max) {
							max = data3[i]["value"];
						}
					}
					// width and barHeight
					var width = 363,
						height = 200,
						barHeight = height / data3.length;
					// range & domain of x
					var x = d3.scale.linear()
					.domain([0, d3.max(values)])
					.range([0, width-150]);
					// chart property
					var chart = d3.select(".age-chart")
							.attr("width", width)
							.attr("height", barHeight * data3.length);
					// bar property
					var bar = chart.selectAll("g")
							.data(values)
							.enter().append("g")
							.attr("transform", function (d, i) { return "translate(80," + i * barHeight + ")"; })
							.attr("class", function (d) {
								if (d == max) { return "max"; }
								else {
									return "non_max";
								}
							});
					// append each rect with its with of x                         
					bar.append("rect")
						.attr("height", function () { return barHeight - 5; })
						.attr("width", x);
					// append age next to each bar
					bar.append("text")
						.attr("x", function (d) { return x(d) + 15; })
						.data(data3)
						.attr("y", barHeight / 2)
						.attr("dy", ".25em")
						.text(function (d) { return d.age_range; });
					// append "Age" on the left of the graph
					chart.append("text")
						.attr("x", 20)
						.attr("y", barHeight * data3.length / 2 - 8)
						.attr("text-anchor", "center")
						.text("Age");
					// append "Range" on the left of the graph
					chart.append("text")
						.attr("x", 12)
						.attr("text-anchor", "center")
						.attr("y", barHeight * data3.length / 2 + 8)
						.text("Range");
				}
		});
	</script>

	<!--Industry Graph-->
	<script>
		//1. give each circle id with its industry name: ex) circle_agriculture
        //2. give each text id with its industry name: ex) text_agriculture
        //3. make all texts' opacity to 0
        //4. when a circle is clicked, parse out the name of its industry and find a 'text' of the same industry and make its opacity to 1 and change the opacity of bmax to 0
    

		var data = [{% for industry in request.session.inbound_stats.industries %}  { "industry": "{{industry.0}}", "value": {{industry.1}} }, {% endfor %}];
		var max = 0;
		for (var i = 0; i < data.length; i++) {
			if (max < data[i]["value"]) {
				max = data[i]["value"];
			}
		}
		var diameter = 300,
			format = d3.format(",d");
		var bubble = d3.layout.pack()
				.sort(null)
				.size([220, 220])
				.padding(1.5);
		var svg = d3.select("#industryGraph").append("svg")
                .attr("width", 364)
				.attr("height", 250)
				.attr("class", "bubble");
   
		data = data.map(function (d) { d.value = d["value"]; return d; });
		//bubbles needs very specific format, convert data to this
		var nodes = bubble.nodes({ children: data }).filter(function (d) { return !d.children; });
		var bubbles = svg.append("g")
			.attr("transform", "translate(40,0)")
			.selectAll(".bubble")
			.data(nodes)
			.enter();

		var id_count = 0;
		var circle = bubbles.append("circle")
            .attr("class", "circle")
            .attr("id", function(d) { 
                //                var str = d["industry"];
                id_count += 1;
                return "circle_" + id_count})
			.attr("r", function (d) { return d.r; })
			.attr("cx", function (d) { return d.x; })
			.attr("cy", function (d) { return d.y + 5; });

		var count = 0;
		id_count = 0;

        bubbles.append("text")
			.attr("x", function (d) { return d.x; })
			.attr("y", function (d) { return d.y + 10; })
			.attr("text-anchor", "middle")
			.text(function (d) { return d["industry"]; })
			.attr("class", function (d) {
			    if (d.value == max && count == 0) {
			        count += 1;
                    return "bmax"
				} else {
					return "bnon_max";
				}
			})
		    .attr("id", function(d){
		        id_count += 1;
		        return id_count});

      

		svg.append("g")
			.append("text")
			.attr("x", 142)
			.attr("y", 215)
			.attr("text-anchor", "middle")
			.text("Industry");
		

        
        // jquery for hover over the box
        var circle_id;
        var text_id;
        $(".circle").mouseover(function(){
            circle_id = $(this).attr("id");
            text_id = circle_id.substring(7);
            $(".bmax").css({opacity:0});
            $("#"+text_id).css({opacity:1});
        })
        $(".circle").mouseout(function() {

            $("#"+text_id).css({opacity:0});
            $(".bmax").css({opacity:1});
        })


			$(".mainCompany").on("click",function(){
				var sid = $(".currentComp").attr("id");
				$("#industryGraph").empty();
				if(sid == "slide1"){
					var data = [{% for industry in request.session.inbound_stats.industries %}  { "industry": "{{industry.0}}", "value": {{industry.1}} }, {% endfor %}];
					var max = 0;
					for (var i = 0; i < data.length; i++) {
						if (max < data[i]["value"]) {
							max = data[i]["value"];
						}
					}
					var diameter = 300,
						format = d3.format(",d");
					var bubble = d3.layout.pack()
							.sort(null)
							.size([220, 220])
							.padding(1.5);
					var svg = d3.select("#industryGraph").append("svg")
			                .attr("width", 364)
							.attr("height", 250)
							.attr("class", "bubble");
			   
					data = data.map(function (d) { d.value = d["value"]; return d; });
					//bubbles needs very specific format, convert data to this
					var nodes = bubble.nodes({ children: data }).filter(function (d) { return !d.children; });
					var bubbles = svg.append("g")
						.attr("transform", "translate(40,0)")
						.selectAll(".bubble")
						.data(nodes)
						.enter();

					var id_count = 0;
					var circle = bubbles.append("circle")
			            .attr("class", "circle")
			            .attr("id", function(d) { 
			                //                var str = d["industry"];
			                id_count += 1;
			                return "circle_" + id_count})
						.attr("r", function (d) { return d.r; })
						.attr("cx", function (d) { return d.x; })
						.attr("cy", function (d) { return d.y + 5; });

					var count = 0;
					id_count = 0;

			        bubbles.append("text")
						.attr("x", function (d) { return d.x; })
						.attr("y", function (d) { return d.y + 10; })
						.attr("text-anchor", "middle")
						.text(function (d) { return d["industry"]; })
						.attr("class", function (d) {
						    if (d.value == max && count == 0) {
						        count += 1;
			                    
			                    return "bmax"
							} else {
								return "bnon_max";
							}
						})
					    .attr("id", function(d){
					        id_count += 1;
					        return id_count});

			      

					svg.append("g")
						.append("text")
						.attr("x", 142)
						.attr("y", 215)
						.attr("text-anchor", "middle")
						.text("Industry");
					

			        
			        // jquery for hover over the box
			        var circle_id;
			        var text_id;
			        $(".circle").mouseover(function(){
			            circle_id = $(this).attr("id");
			            text_id = circle_id.substring(7);
			            $(".bmax").css({opacity:0});
			            $("#"+text_id).css({opacity:1});
			        })
			        $(".circle").mouseout(function() {

			            $("#"+text_id).css({opacity:0});
			            $(".bmax").css({opacity:1});
			        })
							 	
				}else if(sid == "slide2"){
					{%if request.session.30.competitors.0%}
					var data1 = [{% for industry in request.session.30.competitors.0.demographics.industries %}  { "industry": "{{industry.0}}", "value": {{industry.1}} }, {% endfor %}];
					 {%else%}
					 var data1 = [{ "industry": "NONE", "value": 0 }];
					 {%endif%}
					var max = 0;
					for (var i = 0; i < data1.length; i++) {
						if (max < data1[i]["value"]) {
							max = data1[i]["value"];
						}
					}
					var diameter = 300,
						format = d3.format(",d");
					var bubble = d3.layout.pack()
							.sort(null)
							.size([220, 220])
							.padding(1.5);
					var svg = d3.select("#industryGraph").append("svg")
			                .attr("width", 364)
							.attr("height", 250)
							.attr("class", "bubble");
			   
					data1 = data1.map(function (d) { d.value = d["value"]; return d; });
					//bubbles needs very specific format, convert data to this
					var nodes = bubble.nodes({ children: data1 }).filter(function (d) { return !d.children; });
					var bubbles = svg.append("g")
						.attr("transform", "translate(40,0)")
						.selectAll(".bubble")
						.data(nodes)
						.enter();

					var id_count = 0;
					var circle = bubbles.append("circle")
			            .attr("class", "circle")
			            .attr("id", function(d) { 
			                //                var str = d["industry"];
			                id_count += 1;
			                return "circle_" + id_count})
						.attr("r", function (d) { return d.r; })
						.attr("cx", function (d) { return d.x; })
						.attr("cy", function (d) { return d.y + 5; });

					var count = 0;
					id_count = 0;

			        bubbles.append("text")
						.attr("x", function (d) { return d.x; })
						.attr("y", function (d) { return d.y + 10; })
						.attr("text-anchor", "middle")
						.text(function (d) { return d["industry"]; })
						.attr("class", function (d) {
						    if (d.value == max && count == 0) {
						        count += 1;
			                    
			                    return "bmax"
							} else {
								return "bnon_max";
							}
						})
					    .attr("id", function(d){
					        id_count += 1;
					        return id_count});

			      

					svg.append("g")
						.append("text")
						.attr("x", 142)
						.attr("y", 215)
						.attr("text-anchor", "middle")
						.text("Industry");
					

			        
			        // jquery for hover over the box
			        var circle_id;
			        var text_id;
			        $(".circle").mouseover(function(){
			            circle_id = $(this).attr("id");
			            text_id = circle_id.substring(7);
			            $(".bmax").css({opacity:0});
			            $("#"+text_id).css({opacity:1});
			        })
			        $(".circle").mouseout(function() {

			            $("#"+text_id).css({opacity:0});
			            $(".bmax").css({opacity:1});
			        })
				 	
				}else if(sid == "slide3"){
					{%if request.session.30.competitors.1%}
					var data2 = [{% for industry in request.session.30.competitors.1.demographics.industries %}  { "industry": "{{industry.0}}", "value": {{industry.1}} }, {% endfor %}];
					 {%else%}
					 var data2 = [{ "industry": "NONE", "value": 0 }];
					 {%endif%}
					var max = 0;
					for (var i = 0; i < data2.length; i++) {
						if (max < data2[i]["value"]) {
							max = data2[i]["value"];
						}
					}
					var diameter = 300,
						format = d3.format(",d");
					var bubble = d3.layout.pack()
							.sort(null)
							.size([220, 220])
							.padding(1.5);
					var svg = d3.select("#industryGraph").append("svg")
			                .attr("width", 364)
							.attr("height", 250)
							.attr("class", "bubble");
			   
					data2 = data2.map(function (d) { d.value = d["value"]; return d; });
					//bubbles needs very specific format, convert data to this
					var nodes = bubble.nodes({ children: data2 }).filter(function (d) { return !d.children; });
					var bubbles = svg.append("g")
						.attr("transform", "translate(40,0)")
						.selectAll(".bubble")
						.data(nodes)
						.enter();

					var id_count = 0;
					var circle = bubbles.append("circle")
			            .attr("class", "circle")
			            .attr("id", function(d) { 
			                //                var str = d["industry"];
			                id_count += 1;
			                return "circle_" + id_count})
						.attr("r", function (d) { return d.r; })
						.attr("cx", function (d) { return d.x; })
						.attr("cy", function (d) { return d.y + 5; });

					var count = 0;
					id_count = 0;

			        bubbles.append("text")
						.attr("x", function (d) { return d.x; })
						.attr("y", function (d) { return d.y + 10; })
						.attr("text-anchor", "middle")
						.text(function (d) { return d["industry"]; })
						.attr("class", function (d) {
						    if (d.value == max && count == 0) {
						        count += 1;
			                    
			                    return "bmax"
							} else {
								return "bnon_max";
							}
						})
					    .attr("id", function(d){
					        id_count += 1;
					        return id_count});

			      

					svg.append("g")
						.append("text")
						.attr("x", 142)
						.attr("y", 215)
						.attr("text-anchor", "middle")
						.text("Industry");
					

			        
			        // jquery for hover over the box
			        var circle_id;
			        var text_id;
			        $(".circle").mouseover(function(){
			            circle_id = $(this).attr("id");
			            text_id = circle_id.substring(7);
			            $(".bmax").css({opacity:0});
			            $("#"+text_id).css({opacity:1});
			        })
			        $(".circle").mouseout(function() {

			            $("#"+text_id).css({opacity:0});
			            $(".bmax").css({opacity:1});
			        })
				}else if(sid == "slide4"){
					{%if request.session.30.competitors.2%}
					var data3 = [{% for industry in request.session.30.competitors.2.demographics.industries %}  { "industry": "{{industry.0}}", "value": {{industry.1}} }, {% endfor %}];
					 {%else%}
					 var data3 = [{ "industry": "NONE", "value": 0 }];
					 {%endif%}
					var max = 0;
					for (var i = 0; i < data3.length; i++) {
						if (max < data3[i]["value"]) {
							max = data3[i]["value"];
						}
					}
					var diameter = 300,
						format = d3.format(",d");
					var bubble = d3.layout.pack()
							.sort(null)
							.size([220, 220])
							.padding(1.5);
					var svg = d3.select("#industryGraph").append("svg")
			                .attr("width", 364)
							.attr("height", 250)
							.attr("class", "bubble");
			   
					data3 = data3.map(function (d) { d.value = d["value"]; return d; });
					//bubbles needs very specific format, convert data to this
					var nodes = bubble.nodes({ children: data3 }).filter(function (d) { return !d.children; });
					var bubbles = svg.append("g")
						.attr("transform", "translate(40,0)")
						.selectAll(".bubble")
						.data(nodes)
						.enter();

					var id_count = 0;
					var circle = bubbles.append("circle")
			            .attr("class", "circle")
			            .attr("id", function(d) { 
			                //                var str = d["industry"];
			                id_count += 1;
			                return "circle_" + id_count})
						.attr("r", function (d) { return d.r; })
						.attr("cx", function (d) { return d.x; })
						.attr("cy", function (d) { return d.y + 5; });

					var count = 0;
					id_count = 0;

			        bubbles.append("text")
						.attr("x", function (d) { return d.x; })
						.attr("y", function (d) { return d.y + 10; })
						.attr("text-anchor", "middle")
						.text(function (d) { return d["industry"]; })
						.attr("class", function (d) {
						    if (d.value == max && count == 0) {
						        count += 1;
			                    
			                    return "bmax"
							} else {
								return "bnon_max";
							}
						})
					    .attr("id", function(d){
					        id_count += 1;
					        return id_count});

			      

					svg.append("g")
						.append("text")
						.attr("x", 142)
						.attr("y", 215)
						.attr("text-anchor", "middle")
						.text("Industry");
					

			        
			        // jquery for hover over the box
			        var circle_id;
			        var text_id;
			        $(".circle").mouseover(function(){
			            circle_id = $(this).attr("id");
			            text_id = circle_id.substring(7);
			            $(".bmax").css({opacity:0});
			            $("#"+text_id).css({opacity:1});
			        })
			        $(".circle").mouseout(function() {

			            $("#"+text_id).css({opacity:0});
			            $(".bmax").css({opacity:1});
			        })
				}
			});
	</script>

	<!-- Change top Cities -->
	<script>
		$(".mainCompany").on("click",function(){
			var sid = $(".currentComp").attr("id");
			if(sid == "slide1"){
				$("#ntrlC").html('<p>Largest Audience by City<div class="neutralUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.inbound_stats.all_cities.0 %}{{request.session.inbound_stats.all_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.inbound_stats.all_cities.1 %}{{request.session.inbound_stats.all_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.inbound_stats.all_cities.2 %}{{request.session.inbound_stats.all_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.inbound_stats.all_cities.3 %}{{request.session.inbound_stats.all_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.inbound_stats.all_cities.4 %}{{request.session.inbound_stats.all_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.inbound_stats.all_cities.5 %}{{request.session.inbound_stats.all_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.inbound_stats.all_cities.6 %}{{request.session.inbound_stats.all_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.inbound_stats.all_cities.7 %}{{request.session.inbound_stats.all_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.inbound_stats.all_cities.8 %}{{request.session.inbound_stats.all_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.inbound_stats.all_cities.9 %}{{request.session.inbound_stats.all_cities.9.0}}{% else %}-{% endif %}</span></div>	</div>');
				
				$("#posC").html('<p>Largest Positive Audience by City<div class="positiveUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.inbound_stats.positive_cities.0 %}{{request.session.inbound_stats.positive_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.inbound_stats.positive_cities.1 %}{{request.session.inbound_stats.positive_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.inbound_stats.positive_cities.2 %}{{request.session.inbound_stats.positive_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.inbound_stats.positive_cities.3 %}{{request.session.inbound_stats.positive_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.inbound_stats.positive_cities.4 %}{{request.session.inbound_stats.positive_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.inbound_stats.positive_cities.5 %}{{request.session.inbound_stats.positive_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.inbound_stats.positive_cities.6 %}{{request.session.inbound_stats.positive_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.inbound_stats.positive_cities.7 %}{{request.session.inbound_stats.positive_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.inbound_stats.positive_cities.8 %}{{request.session.inbound_stats.positive_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.inbound_stats.positive_cities.9 %}{{request.session.inbound_stats.positive_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
								  
				$("#negC").html('<p>Largest Negative Audience by City<div class="negativeUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.inbound_stats.negative_cities.0 %}{{request.session.inbound_stats.negative_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.inbound_stats.negative_cities.1 %}{{request.session.inbound_stats.negative_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.inbound_stats.negative_cities.2 %}{{request.session.inbound_stats.negative_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.inbound_stats.negative_cities.3 %}{{request.session.inbound_stats.negative_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.inbound_stats.negative_cities.4 %}{{request.session.inbound_stats.negative_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.inbound_stats.negative_cities.5 %}{{request.session.inbound_stats.negative_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.inbound_stats.negative_cities.6 %}{{request.session.inbound_stats.negative_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.inbound_stats.negative_cities.7 %}{{request.session.inbound_stats.negative_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.inbound_stats.negative_cities.8 %}{{request.session.inbound_stats.negative_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.inbound_stats.negative_cities.9 %}{{request.session.inbound_stats.negative_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
								  
			}else if(sid == "slide2"){
				$("#ntrlC").html('<p>Largest Audience by City<div class="neutralUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.0.demographics.all_cities.0 %}{{request.session.30.competitors.0.demographics.all_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.0.demographics.all_cities.1 %}{{request.session.30.competitors.0.demographics.all_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.0.demographics.all_cities.2 %}{{request.session.30.competitors.0.demographics.all_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.0.demographics.all_cities.3 %}{{request.session.30.competitors.0.demographics.all_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.0.demographics.all_cities.4 %}{{request.session.30.competitors.0.demographics.all_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.0.demographics.all_cities.5 %}{{request.session.30.competitors.0.demographics.all_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.0.demographics.all_cities.6 %}{{request.session.30.competitors.0.demographics.all_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.0.demographics.all_cities.7 %}{{request.session.30.competitors.0.demographics.all_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.0.demographics.all_cities.8 %}{{request.session.30.competitors.0.demographics.all_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.0.demographics.all_cities.9 %}{{request.session.30.competitors.0.demographics.all_cities.9.0}}{% else %}-{% endif %}</span></div>	</div>');
				
				$("#posC").html('<p>Largest Positive Audience by City<div class="positiveUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.0.demographics.positive_cities.0 %}{{request.session.30.competitors.0.demographics.positive_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.0.demographics.positive_cities.1 %}{{request.session.30.competitors.0.demographics.positive_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.0.demographics.positive_cities.2 %}{{request.session.30.competitors.0.demographics.positive_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.0.demographics.positive_cities.3 %}{{request.session.30.competitors.0.demographics.positive_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.0.demographics.positive_cities.4 %}{{request.session.30.competitors.0.demographics.positive_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.0.demographics.positive_cities.5 %}{{request.session.30.competitors.0.demographics.positive_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.0.demographics.positive_cities.6 %}{{request.session.30.competitors.0.demographics.positive_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.0.demographics.positive_cities.7 %}{{request.session.30.competitors.0.demographics.positive_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.0.demographics.positive_cities.8 %}{{request.session.30.competitors.0.demographics.positive_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.0.demographics.positive_cities.9 %}{{request.session.30.competitors.0.demographics.positive_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
								  
				$("#negC").html('<p>Largest Negative Audience by City<div class="negativeUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.0.demographics.negative_cities.0 %}{{request.session.30.competitors.0.demographics.negative_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.0.demographics.negative_cities.1 %}{{request.session.30.competitors.0.demographics.negative_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.0.demographics.negative_cities.2 %}{{request.session.30.competitors.0.demographics.negative_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.0.demographics.negative_cities.3 %}{{request.session.30.competitors.0.demographics.negative_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.0.demographics.negative_cities.4 %}{{request.session.30.competitors.0.demographics.negative_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.0.demographics.negative_cities.5 %}{{request.session.30.competitors.0.demographics.negative_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.0.demographics.negative_cities.6 %}{{request.session.30.competitors.0.demographics.negative_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.0.demographics.negative_cities.7 %}{{request.session.30.competitors.0.demographics.negative_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.0.demographics.negative_cities.8 %}{{request.session.30.competitors.0.demographics.negative_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.0.demographics.negative_cities.9 %}{{request.session.30.competitors.0.demographics.negative_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
				
			}else if(sid == "slide3"){
				$("#ntrlC").html('<p>Largest Audience by City<div class="neutralUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.1.demographics.all_cities.0 %}{{request.session.30.competitors.1.demographics.all_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.1.demographics.all_cities.1 %}{{request.session.30.competitors.1.demographics.all_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.1.demographics.all_cities.2 %}{{request.session.30.competitors.1.demographics.all_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.1.demographics.all_cities.3 %}{{request.session.30.competitors.1.demographics.all_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.1.demographics.all_cities.4 %}{{request.session.30.competitors.1.demographics.all_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.1.demographics.all_cities.5 %}{{request.session.30.competitors.1.demographics.all_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.1.demographics.all_cities.6 %}{{request.session.30.competitors.1.demographics.all_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.1.demographics.all_cities.7 %}{{request.session.30.competitors.1.demographics.all_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.1.demographics.all_cities.8 %}{{request.session.30.competitors.1.demographics.all_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.1.demographics.all_cities.9 %}{{request.session.30.competitors.1.demographics.all_cities.9.0}}{% else %}-{% endif %}</span></div>	</div>');
				
				$("#posC").html('<p>Largest Positive Audience by City<div class="positiveUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.1.demographics.positive_cities.0 %}{{request.session.30.competitors.1.demographics.positive_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.1.demographics.positive_cities.1 %}{{request.session.30.competitors.1.demographics.positive_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.1.demographics.positive_cities.2 %}{{request.session.30.competitors.1.demographics.positive_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.1.demographics.positive_cities.3 %}{{request.session.30.competitors.1.demographics.positive_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.1.demographics.positive_cities.4 %}{{request.session.30.competitors.1.demographics.positive_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.1.demographics.positive_cities.5 %}{{request.session.30.competitors.1.demographics.positive_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.1.demographics.positive_cities.6 %}{{request.session.30.competitors.1.demographics.positive_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.1.demographics.positive_cities.7 %}{{request.session.30.competitors.1.demographics.positive_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.1.demographics.positive_cities.8 %}{{request.session.30.competitors.1.demographics.positive_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.1.demographics.positive_cities.9 %}{{request.session.30.competitors.1.demographics.positive_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
								  
				$("#negC").html('<p>Largest Negative Audience by City<div class="negativeUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.1.demographics.negative_cities.0 %}{{request.session.30.competitors.1.demographics.negative_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.1.demographics.negative_cities.1 %}{{request.session.30.competitors.1.demographics.negative_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.1.demographics.negative_cities.2 %}{{request.session.30.competitors.1.demographics.negative_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.1.demographics.negative_cities.3 %}{{request.session.30.competitors.1.demographics.negative_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.1.demographics.negative_cities.4 %}{{request.session.30.competitors.1.demographics.negative_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.1.demographics.negative_cities.5 %}{{request.session.30.competitors.1.demographics.negative_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.1.demographics.negative_cities.6 %}{{request.session.30.competitors.1.demographics.negative_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.1.demographics.negative_cities.7 %}{{request.session.30.competitors.1.demographics.negative_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.1.demographics.negative_cities.8 %}{{request.session.30.competitors.1.demographics.negative_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.1.demographics.negative_cities.9 %}{{request.session.30.competitors.1.demographics.negative_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
				
			}else if(sid == "slide4"){
				$("#ntrlC").html('<p>Largest Audience by City<div class="neutralUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.2.demographics.all_cities.0 %}{{request.session.30.competitors.2.demographics.all_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.2.demographics.all_cities.1 %}{{request.session.30.competitors.2.demographics.all_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.2.demographics.all_cities.2 %}{{request.session.30.competitors.2.demographics.all_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.2.demographics.all_cities.3 %}{{request.session.30.competitors.2.demographics.all_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.2.demographics.all_cities.4 %}{{request.session.30.competitors.2.demographics.all_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.2.demographics.all_cities.5 %}{{request.session.30.competitors.2.demographics.all_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.2.demographics.all_cities.6 %}{{request.session.30.competitors.2.demographics.all_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.2.demographics.all_cities.7 %}{{request.session.30.competitors.2.demographics.all_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.2.demographics.all_cities.8 %}{{request.session.30.competitors.2.demographics.all_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.2.demographics.all_cities.9 %}{{request.session.30.competitors.2.demographics.all_cities.9.0}}{% else %}-{% endif %}</span></div>	</div>');
				
				$("#posC").html('<p>Largest Positive Audience by City<div class="positiveUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.2.demographics.positive_cities.0 %}{{request.session.30.competitors.2.demographics.positive_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.2.demographics.positive_cities.1 %}{{request.session.30.competitors.2.demographics.positive_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.2.demographics.positive_cities.2 %}{{request.session.30.competitors.2.demographics.positive_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.2.demographics.positive_cities.3 %}{{request.session.30.competitors.2.demographics.positive_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.2.demographics.positive_cities.4 %}{{request.session.30.competitors.2.demographics.positive_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.2.demographics.positive_cities.5 %}{{request.session.30.competitors.2.demographics.positive_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.2.demographics.positive_cities.6 %}{{request.session.30.competitors.2.demographics.positive_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.2.demographics.positive_cities.7 %}{{request.session.30.competitors.2.demographics.positive_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.2.demographics.positive_cities.8 %}{{request.session.30.competitors.2.demographics.positive_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.2.demographics.positive_cities.9 %}{{request.session.30.competitors.2.demographics.positive_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
								  
				$("#negC").html('<p>Largest Negative Audience by City<div class="negativeUnderline"></div></p><div class="cities"><div>1. <span id="city1">{% if request.session.30.competitors.2.demographics.negative_cities.0 %}{{request.session.30.competitors.2.demographics.negative_cities.0.0}}{% else %}-{% endif %}</span></div><div>2. <span id="city2">{% if request.session.30.competitors.2.demographics.negative_cities.1 %}{{request.session.30.competitors.2.demographics.negative_cities.1.0}}{% else %}-{% endif %}</span></div><div>3. <span id="city3">{% if request.session.30.competitors.2.demographics.negative_cities.2 %}{{request.session.30.competitors.2.demographics.negative_cities.2.0}}{% else %}-{% endif %}</span></div><div>4. <span id="city4">{% if request.session.30.competitors.2.demographics.negative_cities.3 %}{{request.session.30.competitors.2.demographics.negative_cities.3.0}}{% else %}-{% endif %}</span></div><div>5. <span id="city5">{% if request.session.30.competitors.2.demographics.negative_cities.4 %}{{request.session.30.competitors.2.demographics.negative_cities.4.0}}{% else %}-{% endif %}</span></div><div>6. <span id="city6">{% if request.session.30.competitors.2.demographics.negative_cities.5 %}{{request.session.30.competitors.2.demographics.negative_cities.5.0}}{% else %}-{% endif %}</span></div><div>7. <span id="city7">{% if request.session.30.competitors.2.demographics.negative_cities.6 %}{{request.session.30.competitors.2.demographics.negative_cities.6.0}}{% else %}-{% endif %}</span></div><div>8. <span id="city8">{% if request.session.30.competitors.2.demographics.negative_cities.7 %}{{request.session.30.competitors.2.demographics.negative_cities.7.0}}{% else %}-{% endif %}</span></div><div>9. <span id="city9">{% if request.session.30.competitors.2.demographics.negative_cities.8 %}{{request.session.30.competitors.2.demographics.negative_cities.8.0}}{% else %}-{% endif %}</span></div><div>10. <span id="city10">{% if request.session.30.competitors.2.demographics.negative_cities.9 %}{{request.session.30.competitors.2.demographics.negative_cities.9.0}}{% else %}-{% endif %}</span></div></div>');
				
			}
		});
	</script>
	
	<!--Map Graph-->
	<script>
        
            //data value from jamasen
			var raw_data = { negative: [{% for state in request.session.inbound_stats.negative_states%} "{{state}}", {%endfor %}], positive: [{% for state in request.session.inbound_stats.demographics.positive_states%} "{{state}}", {%endfor %}] };		
		 	var positive = raw_data.positive; // array of positive states
            var negative = raw_data.negative; // array of negative states
            for (var i = 0; i < positive.length; i++) {
                data[positive[i]] = {'fillKey': 'Positive'};}
            for (var i = 0; i < negative.length; i++) {
                data[negative[i]] = {'fillKey': 'Negative'};
            }    
            // Create the Map
            var election = new Datamap({
                scope: 'usa',
                element: document.getElementById('cartograph'),
                geographyConfig: {
                    borderColor: '#282828 ',
                    borderWidth: 1,
                    highlightOnHover: false,
                    popupOnHover: true,
                    popupTemplate: function (geography) {
                        return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
                    }
                },
                fills: {
                    'Positive': '#bce5ba ',
                    'Negative': '#cd6562 ',
                    defaultFill: '#ffffff '
                },
                data: data
            });
			$(".mainCompany").on("click",function(){
				data = {};
				var sid = $(".currentComp").attr("id");
				$("#cartograph").empty();
				if(sid == "slide1"){
					var positive_me = raw_data.positive; // array of positive states
					var negative_me = raw_data.negative; // array of negative states
					for (var i = 0; i < positive_me.length; i++) {
						data[positive_me[i]] = {'fillKey': 'Positive'};}
					for (var i = 0; i < negative_me.length; i++) {
						data[negative_me[i]] = {'fillKey': 'Negative'};
					}    
					// Create the Map
					var election = new Datamap({
						scope: 'usa',
						element: document.getElementById('cartograph'),
						geographyConfig: {
							borderColor: '#282828 ',
							borderWidth: 1,
							highlightOnHover: false,
							popupOnHover: true,
							popupTemplate: function (geography) {
								return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
							}
						},
						fills: {
							'Positive': '#bce5ba ',
							'Negative': '#cd6562 ',
							defaultFill: '#ffffff '
						},
						data: data
					});
				}else if (sid == "slide2"){
					{% if request.session.30.competitors.0%}
						var raw_data_comp0 = { negative: [{% for state in request.session.30.competitors.0.demographics.negative_states%} "{{state}}", {%endfor %}], positive: [{% for state in request.session.30.competitors.0.demographics.positive_states%} "{{state}}", {%endfor %}] };
					{%else%}
					 	var raw_data_comp0 = { negative: [], positive: [] };
					{%endif%}
					var positive_comp0 = raw_data_comp0.positive; // array of positive states
					var negative_comp0 = raw_data_comp0.negative; // array of negative states
					for (var i = 0; i < positive_comp0.length; i++) {
						data[positive_comp0[i]] = {'fillKey': 'Positive'};}
					for (var i = 0; i < negative_comp0.length; i++) {
						data[negative_comp0[i]] = {'fillKey': 'Negative'};
					}    
					// Create the Map
					var election = new Datamap({
						scope: 'usa',
						element: document.getElementById('cartograph'),
						geographyConfig: {
							borderColor: '#282828 ',
							borderWidth: 1,
							highlightOnHover: false,
							popupOnHover: true,
							popupTemplate: function (geography) {
								return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
							}
						},
						fills: {
							'Positive': '#bce5ba ',
							'Negative': '#cd6562 ',
							defaultFill: '#ffffff '
						},
						data: data
					});
				}else if (sid == "slide3"){
					{% if request.session.30.competitors.1%}
						var raw_data_comp1 = { negative: [{% for state in request.session.30.competitors.1.demographics.negative_states%} "{{state}}", {%endfor %}], positive: [{% for state in request.session.30.competitors.1.demographics.positive_states%} "{{state}}", {%endfor %}] };
					{%else%}
					 	var raw_data_comp1 = { negative: [], positive: [] };
					{%endif%}
					var positive_comp1 = raw_data_comp1.positive; // array of positive states
					var negative_comp1 = raw_data_comp1.negative; // array of negative states
					for (var i = 0; i < positive_comp1.length; i++) {
						data[positive_comp1[i]] = {'fillKey': 'Positive'};}
					for (var i = 0; i < negative_comp1.length; i++) {
						data[negative_comp1[i]] = {'fillKey': 'Negative'};
					}    
					// Create the Map
					var election = new Datamap({
						scope: 'usa',
						element: document.getElementById('cartograph'),
						geographyConfig: {
							borderColor: '#282828 ',
							borderWidth: 1,
							highlightOnHover: false,
							popupOnHover: true,
							popupTemplate: function (geography) {
								return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
							}
						},
						fills: {
							'Positive': '#bce5ba ',
							'Negative': '#cd6562 ',
							defaultFill: '#ffffff '
						},
						data: data
					});
				}else if (sid == "slide4"){
					{% if request.session.30.competitors.2%}
						var raw_data_comp2 = { negative: [{% for state in request.session.30.competitors.2.demographics.negative_states%} "{{state}}", {%endfor %}], positive: [{% for state in request.session.30.competitors.2.demographics.positive_states%} "{{state}}", {%endfor %}] };
					{%else%}
					 	var raw_data_comp2 = { negative: [], positive: [] };
					{%endif%}
					var positive_comp2 = raw_data_comp2.positive; // array of positive states
					var negative_comp2 = raw_data_comp2.negative; // array of negative states
					for (var i = 0; i < positive_comp2.length; i++) {
						data[positive_comp2[i]] = {'fillKey': 'Positive'};}
					for (var i = 0; i < negative_comp2.length; i++) {
						data[negative_comp2[i]] = {'fillKey': 'Negative'};
					}    
					// Create the Map
					var election = new Datamap({
						scope: 'usa',
						element: document.getElementById('cartograph'),
						geographyConfig: {
							borderColor: '#282828 ',
							borderWidth: 1,
							highlightOnHover: false,
							popupOnHover: true,
							popupTemplate: function (geography) {
								return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
							}
						},
						fills: {
							'Positive': '#bce5ba ',
							'Negative': '#cd6562 ',
							defaultFill: '#ffffff '
						},
						data: data
					});
				}
			});
    </script>

	<!--Textarea-->
	<script>
			$("#tweetContainer").delegate("textarea","click",function(){
				var name = $(this).attr("thisname");
				if($(this).val()==""){
					$(this).val("@"+name);
				}
			});
			
			$("#tweetContainer").delegate(".sendTweetBtn","click",function(e){
				e.preventDefault();
				var sid;
				var valText;
				var idtag;
				var str = $(this).attr("id");
				sid = str.replace("tweetBtn","tweetForm");
				sid = sid.replace("sendTweet","");
				idtag = "#"+sid;
				valText = $(idtag).val();
				if(valText.length>0){
					$(this).text("Sending...");
					$.ajax({
							type: "post",
							data: $("#"+sid+"form").serialize(),
					})
					  .done(function(e) {	

							$(idtag).prop("placeholder","Send another tweet!");
							$(idtag).val("");
							$("#"+str).text("Sent!");
							$("#"+str).css({backgroundColor:"#bce5ba", borderColor: "#84c682", color: "#222"});
							window.setTimeout(function(){
								$("#"+str).text("Send Tweet");
								$("#"+str).css({backgroundColor:"", borderColor: "", color:""});
							},1000);
							
					  })
					  .fail(function(e){
							alert("Error. We can't send your tweet.");
							$("#"+str).text("Send Tweet");
					  })
					
				}
				else{
					alert("Please type something to tweet.");
					$("#"+str).text("Tweet");
				}
			});
	</script>
	
	<!--Filter Selection-->
	<script>
		var oclass = "";
		var pid = "";
		
		$(".filter").on("click",function(e){
			var thisid=$(this).attr("id");
			$("#"+thisid+">.companyCheckbox>.checked").toggleClass("hidden");
			var hasthisclass=$("#"+thisid+">.companyCheckbox>.checked").attr("class");
			if(hasthisclass == "fa fa-check checked"){
				if(thisid == "allFilter"){
					$("#allFilterCheckbox").prop("checked",true);
					$(".filter>.companyCheckbox>.checked").removeClass("hidden");
					$("#followFilterCheckbox").prop("checked",false);
					$("#subscriberFilterCheckbox").prop("checked",false);
					$("#positiveFilterCheckbox").prop("checked",false);
					$("#negativeFilterCheckbox").prop("checked",false);
					$("#topTenFilterCheckbox").prop("checked",false);
				}
				if(thisid == "followFilter"){
					$("#followFilterCheckbox").prop("checked",true);
				}
				if(thisid == "subscriberFilter"){
					$("#subscriberFilterCheckbox").prop("checked",true);
				}
				if(thisid == "positiveFilter"){
					$("#positiveFilterCheckbox").prop("checked",true);
				}
				if(thisid == "negativeFilter"){
					$("#negativeFilterCheckbox").prop("checked",true);
				}
				if(thisid == "topTenFilter"){
					$("#topTenFilterCheckbox").prop("checked",true);
				}
			}else {
				if(thisid == "allFilter"){
					$("#allFilterCheckbox").prop("checked",false);
					$(".filter>.companyCheckbox>.checked").addClass("hidden");
					$("#followFilterCheckbox").prop("checked",false);
					$("#subscriberFilterCheckbox").prop("checked",false);
					$("#positiveFilterCheckbox").prop("checked",false);
					$("#negativeFilterCheckbox").prop("checked",false);
					$("#topTenFilterCheckbox").prop("checked",false);
				}
				if(thisid == "followFilter"){
					$("#followFilterCheckbox").prop("checked",false);
				}
				if(thisid == "subscriberFilter"){
					$("#subscriberFilterCheckbox").prop("checked",false);
				}
				if(thisid == "positiveFilter"){
					$("#positiveFilterCheckbox").prop("checked",false);
				}
				if(thisid == "negativeFilter"){
					$("#negativeFilterCheckbox").prop("checked",false);
				}
				if(thisid == "topTenFilter"){
					$("#topTenFilterCheckbox").prop("checked",false);
				}
			}
		
		});
		var pagenumber = 1;
		function getPeople(pagenumber) {
			$.ajax({
						type: "post",
						data: currentForm,
						url: "/legion/inbound_info/"+pagenumber,
					})
					.done(function(e){	
						if($(".errorMsg").hasClass("hidden")){
						}else{
							$(".successMsg").removeClass("hidden");
							$(".errorMsg").addClass("hidden");
						}
						//add filtered people into leadstream
						$("#leadStream").empty();
						var tweetList = "";
						var k=0;
						var shortName ="";
						if(e.length < 11){
							for(var i = 0; i<e.length; i++){
								tweetList = "";
								if(e[i].num_tweets > 0){
									for(var j=0; j<e[i].num_tweets; j++){
										k = j+1;
										tweetList += '<div class="hidden" id="'+e[i].id+'ind_tweet'+k+'" value="'+e[i].tweets[j].text+'"></div><div class="hidden" id="'+e[i].id+'ind_tweet_score'+k+'" value="'+e[i].tweets[j].textblob_sentiment+'"></div><div class="hidden" id="'+e[i].id+'ind_tweet_time'+k+'" value="'+e[i].tweets[j].datestr+'"></div><div class="hidden" id="'+e[i].id+'ind_tweet_id'+k+'" value="'+e[i].tweets[j].status_id+'"></div>';
									}//forloop
								}//if statement
								shortName = e[i].name.substr(0,17);
								$("#leadStream").append('<div class="newOutboundLead" id="'+e[i].id+'"><img class="leadPhoto" src="https://s3-us-west-2.amazonaws.com/tier5/'+e[i].saved_photo+'"/><div class="hidden" id="ind_photo'+e[i].id+'" value="https://s3-us-west-2.amazonaws.com/tier5/'+e[i].saved_photo+'"></div><div class="hidden" id="ind_location'+e[i].id+'" value="'+e[i].location+'"></div><div class="hidden" id="ind_website'+e[i].id+'" value="'+e[i].personal_home_page+'"></div><div class="hidden" id="ind_email'+e[i].id+'" value="'+e[i].emailaddress__address+'"></div><div class="hidden" id="ind_klout'+e[i].id+'" value="'+e[i].klout_score+'"></div><div class="hidden" id="ind_sentiment'+e[i].id+'" value="'+e[i].sentiment+'"></div><div class="hidden" id="ind_age'+e[i].id+'" value="'+e[i].age+'"></div><div class="hidden" id="ind_fb'+e[i].id+'" value="'+e[i].personal_facebook+'"></div><div class="hidden" id="ind_tw'+e[i].id+'" value="'+e[i].personal_twitter+'"></div><div class="hidden" id="ind_tweetNum'+e[i].id+'" value="'+e[i].num_tweets+'"></div><div class="hidden" id="ind_ln'+e[i].id+'" value="'+e[i].personal_linkedin+'"></div><div class="hidden" id="ind_name'+e[i].id+'" value="'+shortName+'"></div>'+tweetList+'<div class="leadName">'+e[i].name+'<span> followed @{{request.user.twitter_handle}}</span></div></div>');
							}//forloop
						}else{
							for(var i = 0; i<10; i++){
								tweetList = "";
								if(e[i].num_tweets > 0){
									for(var j=0; j<e[i].num_tweets; j++){
										k = j+1;
										tweetList += '<div class="hidden" id="'+e[i].id+'ind_tweet'+k+'" value="'+e[i].tweets[j].text+'"></div><div class="hidden" id="'+e[i].id+'ind_tweet_score'+k+'" value="'+e[i].tweets[j].textblob_sentiment+'"></div><div class="hidden" id="'+e[i].id+'ind_tweet_time'+k+'" value="'+e[i].tweets[j].datestr+'"></div><div class="hidden" id="'+e[i].id+'ind_tweet_id'+k+'" value="'+e[i].tweets[j].status_id+'"></div>';
									}//forloop
								}//if statement
							
								shortName = e[i].name.substr(0,17);
								$("#leadStream").append('<div class="newOutboundLead" id="'+e[i].id+'"><img class="leadPhoto" src="https://s3-us-west-2.amazonaws.com/tier5/'+e[i].saved_photo+'"/><div class="hidden" id="ind_photo'+e[i].id+'" value="https://s3-us-west-2.amazonaws.com/tier5/'+e[i].saved_photo+'"></div><div class="hidden" id="ind_location'+e[i].id+'" value="'+e[i].location+'"></div><div class="hidden" id="ind_website'+e[i].id+'" value="'+e[i].personal_home_page+'"></div><div class="hidden" id="ind_email'+e[i].id+'" value="'+e[i].emailaddress__address+'"></div><div class="hidden" id="ind_klout'+e[i].id+'" value="'+e[i].klout_score+'"></div><div class="hidden" id="ind_sentiment'+e[i].id+'" value="'+e[i].sentiment+'"></div><div class="hidden" id="ind_age'+e[i].id+'" value="'+e[i].age+'"></div><div class="hidden" id="ind_fb'+e[i].id+'" value="'+e[i].personal_facebook+'"></div><div class="hidden" id="ind_tw'+e[i].id+'" value="'+e[i].personal_twitter+'"></div><div class="hidden" id="ind_tweetNum'+e[i].id+'" value="'+e[i].num_tweets+'"></div><div class="hidden" id="ind_ln'+e[i].id+'" value="'+e[i].personal_linkedin+'"></div><div class="hidden" id="ind_name'+e[i].id+'" value="'+shortName+'"></div>'+tweetList+'<div class="leadName">'+e[i].name+'<span> followed @{{request.user.twitter_handle}}</span></div></div>');
							}
						}
						//append a next ten button
						$("#leadStream").append('<div class="pageTurner" id="nextPage"><p>Next 10</p></div><div class="pageTurner" id="previousPage"><p>Previous 10</p></div>');
						if(e.has_next_page){
							if(pagenumber == 1){
								$("#previousPage").addClass("hidden");
							}else{
								$("#previousPage").removeClass("hidden");
							}
							$("#nextPage").removeClass("hidden");
						}else{
							if(pagenumber == 1){
								$("#previousPage").addClass("hidden");
							}else{
								$("#previousPage").removeClass("hidden");
							}
							$("#nextPage").addClass("hidden");
						}
					})
					.fail(function(e){
						$(".errorMsg").removeClass("hidden");
					})
					.complete(function(){
						window.setTimeout(function(){
							$(".successMsg").addClass("hidden");
						},1000);
						$("#consumerFilterBtn").text("Search");
					});
					
		}
		var currentForm = "";
		$("#consumerFilterBtn").on("click", function(event){
			currentForm = $("#filterForm").serialize();
			event.preventDefault();
			$("#consumerFilterBtn").text("Searching...");
			pagenumber = 1;
			getPeople(pagenumber);
		})

		$("#leadStream").delegate(".pageTurner","click",function(){
			var pageId = $(this).attr("id");
			$("#"+pageId).text("Loading...");
			if(pageId == "nextPage"){
				pagenumber++;
			}else{
				pagenumber--;
			}
				getPeople(pagenumber);
		});
			
	</script>
	<script type="text/javascript">
		var thisid = "";
		var compid = "";
		$(".slideReel").on("mouseenter",function(){
			thisid = $(".currentComp").attr("id");
			compid =  $(".currentComp").attr("comp");
			if (thisid != "slide1"){
				$(".deleteCircle").removeClass("hidden");
			}
		});
		$(".d3GraphContainer").hover(function(){
			$(".deleteCircle").addClass("hidden");
		});
		$(".arrow").on("click",function(){
			$(".deleteCircle").addClass("hidden");
		});

		$(".deleteCircle").on("click",function(){
			$("#"+thisid).fadeOut(300);
			$(".leftArrow").trigger("click");
			$.ajax({
				type: "post",
				data: {"deleteCompetitor":compid},
			}).done(function(e){
				if($(".errorMsg").hasClass("hidden")){
				}else{
					$(".successMsg").removeClass("hidden");
					$(".errorMsg").addClass("hidden");
				}
				location.reload();
			}).fail(function(e){
				$(".errorMsg").removeClass("hidden");
			})
			.complete(function(){
				window.setTimeout(function(){
					$(".successMsg").addClass("hidden");
				},1000);
			});
		});
	</script>

	<script type="text/javascript">
		{% if request.session.30.me.market_events%}
		var	thisid = "";
		$(".d3GraphContainer").on("mouseout",function(){
			$(".deleteMarketEvent").addClass("hidden");
		});
		$(".sentimentSignal").on("mouseenter",function(){
			thisid = $(this).attr("id");
			var thisheight = $(this).height();
			var thisposition = $(this).position();
			var calcHeight = thisposition.top + thisheight/2 + 62;
			$(".deleteMarketEvent").css({
				top: calcHeight+"px"
			});
			$(".deleteMarketEvent").removeClass("hidden");
		});
		$(".deleteMarketEvent").on("click",function(){
			$("#"+thisid).fadeOut(300);
			$.ajax({
				type: "post",
				data: {"deleteMarketEvent":thisid},
			}).done(function(e){
				if($(".errorMsg").hasClass("hidden")){
				}else{
					$(".successMsg").removeClass("hidden");
					$(".errorMsg").addClass("hidden");
				}
				
			}).fail(function(e){
				$(".errorMsg").removeClass("hidden");
			})
			.complete(function(){
				window.setTimeout(function(){
					$(".successMsg").addClass("hidden");
				},1000);
			});
		});
		{% endif %}
	
	</script>
	<script type="text/javascript">
		$(document).ready(function(){
			$("#datetimeInput").datepicker({
				dateFormat: "yy-mm-dd"
			});
		});
		
	</script>

</body>
</html>